!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).SplitPolygonMode={})}(this,(function(t){"use strict";function e(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return n(t);case"FeatureCollection":return function(t){var e={type:"FeatureCollection"};return Object.keys(t).forEach((function(n){switch(n){case"type":case"features":return;default:e[n]=t[n]}})),e.features=t.features.map((function(t){return n(t)})),e}(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return o(t);default:throw new Error("unknown GeoJSON type")}}function n(t){var e={type:"Feature"};return Object.keys(t).forEach((function(n){switch(n){case"type":case"properties":case"geometry":return;default:e[n]=t[n]}})),e.properties=r(t.properties),e.geometry=o(t.geometry),e}function r(t){var e={};return t?(Object.keys(t).forEach((function(n){var o=t[n];"object"==typeof o?null===o?e[n]=null:Array.isArray(o)?e[n]=o.map((function(t){return t})):e[n]=r(o):e[n]=o})),e):e}function o(t){var e={type:t.type};return t.bbox&&(e.bbox=t.bbox),"GeometryCollection"===t.type?(e.geometries=t.geometries.map((function(t){return o(t)})),e):(e.coordinates=i(t.coordinates),e)}function i(t){var e=t;return"object"!=typeof e[0]?e.slice():e.map((function(t){return i(t)}))}var s=6371008.8,a={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:39.37*s,kilometers:6371.0088,kilometres:6371.0088,meters:s,metres:s,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:s/1852,radians:1,yards:6967335.223679999};function u(t,e,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function l(t,e,n){void 0===n&&(n={});for(var r=0,o=t;r<o.length;r++){var i=o[r];if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<i[i.length-1].length;s++)if(i[i.length-1][s]!==i[0][s])throw new Error("First and last Position are not equivalent.")}return u({type:"Polygon",coordinates:t},e,n)}function c(t,e,n){if(void 0===n&&(n={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return u({type:"LineString",coordinates:t},e,n)}function f(t,e){void 0===e&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function h(t,e,n){return void 0===n&&(n={}),u({type:"MultiLineString",coordinates:t},e,n)}function p(t,e,n){return void 0===n&&(n={}),u({type:"MultiPolygon",coordinates:t},e,n)}function d(t,e){return n=function(t,e){void 0===e&&(e="kilometers");var n=a[e];if(!n)throw new Error(e+" units is invalid");return t/n}(t,e),n%(2*Math.PI)*180/Math.PI;var n}function g(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function y(t){return!!t&&t.constructor===Object}function v(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function m(t){return"Feature"===t.type?t.geometry:t}function b(t){for(var e,n,r=v(t),o=0,i=1;i<r.length;)e=n||r[0],o+=((n=r[i])[0]-e[0])*(n[1]+e[1]),i++;return o>0}function E(t,e,n){if(null!==t)for(var r,o,i,s,a,u,l,c,f=0,h=0,p=t.type,d="FeatureCollection"===p,g="Feature"===p,y=d?t.features.length:1,v=0;v<y;v++){a=(c=!!(l=d?t.features[v].geometry:g?t.geometry:t)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var m=0;m<a;m++){var b=0,_=0;if(null!==(s=c?l.geometries[m]:l)){u=s.coordinates;var x=s.type;switch(f=!n||"Polygon"!==x&&"MultiPolygon"!==x?0:1,x){case null:break;case"Point":if(!1===e(u,h,v,b,_))return!1;h++,b++;break;case"LineString":case"MultiPoint":for(r=0;r<u.length;r++){if(!1===e(u[r],h,v,b,_))return!1;h++,"MultiPoint"===x&&b++}"LineString"===x&&b++;break;case"Polygon":case"MultiLineString":for(r=0;r<u.length;r++){for(o=0;o<u[r].length-f;o++){if(!1===e(u[r][o],h,v,b,_))return!1;h++}"MultiLineString"===x&&b++,"Polygon"===x&&_++}"Polygon"===x&&b++;break;case"MultiPolygon":for(r=0;r<u.length;r++){for(_=0,o=0;o<u[r].length;o++){for(i=0;i<u[r][o].length-f;i++){if(!1===e(u[r][o][i],h,v,b,_))return!1;h++}_++}b++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(!1===E(s.geometries[r],e,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function _(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var n=0;n<t.features.length&&!1!==e(t.features[n],n);n++);}function x(t,e){var n,r,o,i,s,a,u,l,c,f,h=0,p="FeatureCollection"===t.type,d="Feature"===t.type,g=p?t.features.length:1;for(n=0;n<g;n++){for(a=p?t.features[n].geometry:d?t.geometry:t,l=p?t.features[n].properties:d?t.properties:{},c=p?t.features[n].bbox:d?t.bbox:void 0,f=p?t.features[n].id:d?t.id:void 0,s=(u=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,o=0;o<s;o++)if(null!==(i=u?a.geometries[o]:a))switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(i,h,l,c,f))return!1;break;case"GeometryCollection":for(r=0;r<i.geometries.length;r++)if(!1===e(i.geometries[r],h,l,c,f))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,h,l,c,f))return!1;h++}}function S(t,e){x(t,(function(t,n,r,o,i){var s,a=null===t?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1!==e(u(t,r,{bbox:o,id:i}),n,0)&&void 0}switch(a){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var l=0;l<t.coordinates.length;l++){var c=t.coordinates[l];if(!1===e(u({type:s,coordinates:c},r),n,l))return!1}}))}function w(t,e){switch("Feature"===t.type?t.geometry.type:t.type){case"GeometryCollection":return x(t,(function(t){w(t,e)})),t;case"LineString":return P(v(t),e),t;case"Polygon":return C(v(t),e),t;case"MultiLineString":return v(t).forEach((function(t){P(t,e)})),t;case"MultiPolygon":return v(t).forEach((function(t){C(t,e)})),t;case"Point":case"MultiPoint":return t}}function P(t,e){b(t)===e&&t.reverse()}function C(t,e){b(t[0])!==e&&t[0].reverse();for(var n=1;n<t.length;n++)b(t[n])===e&&t[n].reverse()}function M(t,e){for(var n=0,r=0,o=0,i=0,s=0,a=0,u=0,l=0,c=null,f=null,h=t[0],p=t[1],d=e.length;n<d;n++){r=0;var g=e[n].length-1,y=e[n];if((c=y[0])[0]!==y[g][0]&&c[1]!==y[g][1])throw new Error("First and last coordinates in a ring must be the same");for(s=c[0]-h,a=c[1]-p;r<g;r++)if(l=(f=y[r+1])[1]-p,a<0&&l<0||a>0&&l>0)a=l,s=(c=f)[0]-h;else{if(u=f[0]-t[0],l>0&&a<=0){if((i=s*l-u*a)>0)o+=1;else if(0===i)return 0}else if(a>0&&l<=0){if((i=s*l-u*a)<0)o+=1;else if(0===i)return 0}else if(0===l&&a<0){if(0===(i=s*l-u*a))return 0}else if(0===a&&l<0){if(0===(i=s*l-u*a))return 0}else if(0===a&&0===l){if(u<=0&&s>=0)return 0;if(s<=0&&u>=0)return 0}c=f,a=l,s=u}}return o%2!=0}const I=134217729;function O(t,e,n,r,o){let i,s,a,u,l=e[0],c=r[0],f=0,h=0;c>l==c>-l?(i=l,l=e[++f]):(i=c,c=r[++h]);let p=0;if(f<t&&h<n)for(c>l==c>-l?(s=l+i,a=i-(s-l),l=e[++f]):(s=c+i,a=i-(s-c),c=r[++h]),i=s,0!==a&&(o[p++]=a);f<t&&h<n;)c>l==c>-l?(s=i+l,u=s-i,a=i-(s-u)+(l-u),l=e[++f]):(s=i+c,u=s-i,a=i-(s-u)+(c-u),c=r[++h]),i=s,0!==a&&(o[p++]=a);for(;f<t;)s=i+l,u=s-i,a=i-(s-u)+(l-u),l=e[++f],i=s,0!==a&&(o[p++]=a);for(;h<n;)s=i+c,u=s-i,a=i-(s-u)+(c-u),c=r[++h],i=s,0!==a&&(o[p++]=a);return 0===i&&0!==p||(o[p++]=i),p}function T(t){return new Float64Array(t)}const L=T(4),F=T(8),k=T(12),N=T(16),A=T(4);function R(t,e,n,r,o,i){const s=(e-i)*(n-o),a=(t-o)*(r-i),u=s-a;if(0===s||0===a||s>0!=a>0)return u;const l=Math.abs(s+a);return Math.abs(u)>=33306690738754716e-32*l?u:-function(t,e,n,r,o,i,s){let a,u,l,c,f,h,p,d,g,y,v,m,b,E,_,x,S,w;const P=t-o,C=n-o,M=e-i,T=r-i;E=P*T,h=I*P,p=h-(h-P),d=P-p,h=I*T,g=h-(h-T),y=T-g,_=d*y-(E-p*g-d*g-p*y),x=M*C,h=I*M,p=h-(h-M),d=M-p,h=I*C,g=h-(h-C),y=C-g,S=d*y-(x-p*g-d*g-p*y),v=_-S,f=_-v,L[0]=_-(v+f)+(f-S),m=E+v,f=m-E,b=E-(m-f)+(v-f),v=b-x,f=b-v,L[1]=b-(v+f)+(f-x),w=m+v,f=w-m,L[2]=m-(w-f)+(v-f),L[3]=w;let R=function(t,e){let n=e[0];for(let r=1;r<t;r++)n+=e[r];return n}(4,L),D=22204460492503146e-32*s;if(R>=D||-R>=D)return R;if(f=t-P,a=t-(P+f)+(f-o),f=n-C,l=n-(C+f)+(f-o),f=e-M,u=e-(M+f)+(f-i),f=r-T,c=r-(T+f)+(f-i),0===a&&0===u&&0===l&&0===c)return R;if(D=11093356479670487e-47*s+33306690738754706e-32*Math.abs(R),R+=P*c+T*a-(M*l+C*u),R>=D||-R>=D)return R;E=a*T,h=I*a,p=h-(h-a),d=a-p,h=I*T,g=h-(h-T),y=T-g,_=d*y-(E-p*g-d*g-p*y),x=u*C,h=I*u,p=h-(h-u),d=u-p,h=I*C,g=h-(h-C),y=C-g,S=d*y-(x-p*g-d*g-p*y),v=_-S,f=_-v,A[0]=_-(v+f)+(f-S),m=E+v,f=m-E,b=E-(m-f)+(v-f),v=b-x,f=b-v,A[1]=b-(v+f)+(f-x),w=m+v,f=w-m,A[2]=m-(w-f)+(v-f),A[3]=w;const U=O(4,L,4,A,F);E=P*c,h=I*P,p=h-(h-P),d=P-p,h=I*c,g=h-(h-c),y=c-g,_=d*y-(E-p*g-d*g-p*y),x=M*l,h=I*M,p=h-(h-M),d=M-p,h=I*l,g=h-(h-l),y=l-g,S=d*y-(x-p*g-d*g-p*y),v=_-S,f=_-v,A[0]=_-(v+f)+(f-S),m=E+v,f=m-E,b=E-(m-f)+(v-f),v=b-x,f=b-v,A[1]=b-(v+f)+(f-x),w=m+v,f=w-m,A[2]=m-(w-f)+(v-f),A[3]=w;const j=O(U,F,4,A,k);E=a*c,h=I*a,p=h-(h-a),d=a-p,h=I*c,g=h-(h-c),y=c-g,_=d*y-(E-p*g-d*g-p*y),x=u*l,h=I*u,p=h-(h-u),d=u-p,h=I*l,g=h-(h-l),y=l-g,S=d*y-(x-p*g-d*g-p*y),v=_-S,f=_-v,A[0]=_-(v+f)+(f-S),m=E+v,f=m-E,b=E-(m-f)+(v-f),v=b-x,f=b-v,A[1]=b-(v+f)+(f-x),w=m+v,f=w-m,A[2]=m-(w-f)+(v-f),A[3]=w;const B=O(j,k,4,A,N);return N[B-1]}(t,e,n,r,o,i,l)}var D=function(t,e,n,r,o){this.p1=t,this.p2=e,this.edgeType=n,this.originalIndex=r,this.polygonContourId=o,this.interiorRing=!1,this.minX=Math.min(t.p[0],e.p[0]),this.minY=Math.min(t.p[1],e.p[1]),this.maxX=Math.max(t.p[0],e.p[0]),this.maxY=Math.max(t.p[1],e.p[1]),this.intersectionPoints=[],this.nextEdge=null},U=function(t){this.p=t},j=function(t,e){this.id=t,this.rawCoords=e};function B(t,e){return!(t.maxX<e[0])&&(!(t.minX>e[2])&&(!(t.maxY<e[1])&&!(t.minY>e[3])))}var G=function(t,e,n,r){this.p=t,this.polylineEdge=e,this.polygonEdge=n,this.isHeadingIn=r,this.distanceFromPolylineEdgeStart=V(this.polylineEdge.p1.p,this.p),this.distanceFromPolygonEdgeStart=V(this.polygonEdge.p1.p,this.p),this.polygonEdge.intersectionPoints.push(this),this.polylineEdge.intersectionPoints.push(this),this.visitCount=0};function V(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*=n,r*=r,Math.sqrt(n+r)}G.prototype.incrementVisitCount=function(){this.visitCount=this.visitCount+1};function Y(t,e){return t[0]*e[1]-t[1]*e[0]}function X(t,e){return t[0]*e[0]+t[1]*e[1]}function z(t,e,n){return[t[0]+e*n[0],t[1]+e*n[1]]}function q(t,e,n){var r=[t.p2.p[0]-t.p1.p[0],t.p2.p[1]-t.p1.p[1]],o=[e.p2.p[0]-e.p1.p[0],e.p2.p[1]-e.p1.p[1]],i=[e.p1.p[0]-t.p1.p[0],e.p1.p[1]-t.p1.p[1]],s=Y(r,o),a=s*s,u=X(r,r);if(a>0){var l=Y(i,o)/s;if(l<0||l>1)return null;var c=Y(i,r)/s;return c<0||c>1?null:0===l||1===l?n?null:[z(t.p1.p,l,r)]:0===c||1===c?n?null:[z(e.p1.p,c,o)]:[z(t.p1.p,l,r)]}var f=X(i,i);if((a=(s=Y(i,r))*s)>1e-9*u*f)return null;var h=X(r,i)/u,p=h+X(r,o)/u,d=Math.min(h,p),g=Math.max(h,p);return d<=1&&g>=0?1===d?n?null:[z(t.p1.p,d>0?d:0,r)]:0===g?n?null:[z(t.p1.p,g<1?g:1,r)]:n&&0===d&&1===g?null:[z(t.p1.p,d>0?d:0,r),z(t.p1.p,g<1?g:1,r)]:null}function J(t,n){var r=function(t,n){if(!y(n=n||{}))throw new Error("options is invalid");var r=n.reverse||!1,o=n.mutate||!1;if(!t)throw new Error("<geojson> is required");if("boolean"!=typeof r)throw new Error("<reverse> must be a boolean");if("boolean"!=typeof o)throw new Error("<mutate> must be a boolean");!1===o&&(t=e(t));var i=[];switch(t.type){case"GeometryCollection":return x(t,(function(t){w(t,r)})),t;case"FeatureCollection":return _(t,(function(t){_(w(t,r),(function(t){i.push(t)}))})),f(i)}return w(t,r)}(t),o=[],i=[],s=[],a=function(t,e,n,r,o){for(var i=0,s=[],a="Feature"===e.type?e.geometry:e,u="LineString"===a.type?[a.coordinates]:a.coordinates,l=0,c=0;c<u.length;c++){for(var f=u[c].length-1,h=new U(u[c][0]),p=null,d={nextEdge:null},g=0;g<f;g++){p=new U(u[c][g+1]),h.nextPoint=p,p.prevPoint=h;var y=new D(h,p,"polyline",l,null);r.push(y),d.nextEdge=y,y.prevEdge=d,o[0]=Math.min(o[0],h.p[0]),o[1]=Math.min(o[1],h.p[1]),o[2]=Math.max(o[2],h.p[0]),o[3]=Math.max(o[3],h.p[1]),h=p,l+=1,d=y}o[0]=Math.min(o[0],u[c][f][0]),o[1]=Math.min(o[1],u[c][f][1]),o[2]=Math.max(o[2],u[c][f][0]),o[3]=Math.max(o[3],u[c][f][1])}for(var v="Feature"===t.type?t.geometry:t,m="Polygon"===v.type?[v.coordinates]:v.coordinates,b=m.length,E=0;E<b;E++)for(var _=m[E].length,x=0;x<_;x++){i+=1;var S=m[E][x],w=S.length;s.push(new j(i,S));for(var P=new U(S[0]),C=P,M=void 0,I=null,O={nextEdge:null,prevEdge:null},T=null,L=1;L<w;L++)M=new U(S[L]),C.nextPoint=M,M.prevPoint=C,I=new D(C,M,"polygon",l,i),O.nextEdge=I,I.prevEdge=O,1===L&&(T=I),x>0&&(I.interiorRing=!0),I.intersectPolylineBbox=B(I,o),n.push(I),C=M,l+=1,O=I;I.nextEdge=T,T.prevEdge=I,M.nextPoint=P.nextPoint,P.prevPoint=M.prevPoint}return s}(r,n,i,s,[1/0,1/0,1/0,1/0]);if(function(t,e,n){var r,o,i,s=e.length,a=t.length;for(r=0;r<s;r++){var u=e[r];for(o=0;o<a;o++){var l=t[o];if(l.intersectPolylineBbox&&!(l.maxX<u.minX||l.minX>u.maxX||l.maxY<u.minY||l.minY>u.maxY)){var c=q(u,l);if(null!==c)for(i=0;i<c.length;i++){var f=R(l.p1.p[0],l.p1.p[1],l.p2.p[0],l.p2.p[1],u.p1.p[0],u.p1.p[1]),h=new G(c[i],u,l,f>0);n.push(h)}}}}e.forEach((function(t){t.intersectionPoints.sort((function(t,e){return t.distanceFromPolylineEdgeStart-e.distanceFromPolylineEdgeStart}))})),t.forEach((function(t){t.intersectionPoints.sort((function(t,e){return t.distanceFromPolygonEdgeStart-e.distanceFromPolygonEdgeStart}))}))}(i,s,o),0===o.length)return t;var u={};a.forEach((function(t){return u[t.id]=0})),o.forEach((function(t){var e=t.polygonEdge.polygonContourId;u[e]=u[e]+1}));for(var l=0,c=[],h=null,p=0;p<s.length;p++){var d=s[p];if(d.intersectionPoints.length>0){h=d.intersectionPoints[0];break}}for(var g=h,v={visitCount:1};h!==v&&!(l>2*o.length);){if(l=l++,v.visitCount>=2){for(var m=!1,b=0;b<o.length;b++){var E=o[b];if(E.visitCount<2){g=E,m=!0;break}}if(!m)break}g.visitCount=g.visitCount+1;var S=[];c.push(S),S.push(g.p),g.visitCount=g.visitCount+1;var P=Z(g,S),C=!1;if(P===(v=P)&&2===o.length)for(var M=0;M<o.length;M++){o[M].visitCount<2&&(C=!0)}for(;P!==g||C;){(P=(P.isHeadingIn?tt:Q)(P,S))!==g&&(P=Z(P,S)),C=!1}if(v.visitCount>=2){for(var I=!1,O=0;O<o.length;O++){var T=o[O];if(T.visitCount<2){g=T,I=!0;break}}I&&(v=g)}g=v}for(var L=c.map((function(t){return[t]})),F=Object.keys(u),k=0;k<F.length;k++){var N=F[k];if(0===u[N])H(W($(i,parseInt(N)),a),L)}return{type:"Feature",properties:{},geometry:{type:"MultiPolygon",coordinates:L}}}function $(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(r.polygonContourId===e)return r}}function W(t,e){return e.find((function(e){return e.id===t.polygonContourId})).rawCoords}function H(t,e){for(var n=0;n<e.length;n++){var r=e[n];if(M(t[0],[r[0]]))return void r.push(t)}e.push([t])}function Z(t,e){var n=t.polygonEdge;if(n.intersectionPoints.length>1&&n.intersectionPoints[n.intersectionPoints.length-1]!==t){var r=K(t,n.intersectionPoints),o=n.intersectionPoints[r+1];return e.push(o.p),o.incrementVisitCount(),o}for(var i=!0;i;){if(e.push(n.p2.p),null===(n=n.nextEdge))return t;n.intersectionPoints.length>0&&(i=!1)}return n.intersectionPoints[0].incrementVisitCount(),e.push(n.intersectionPoints[0].p),n.intersectionPoints[0]}function K(t,e){for(var n=0;n<e.length;n++){if(e[n]===t)return n}return null}function Q(t,e){var n=t.polylineEdge;if(2===n.intersectionPoints.length){var r=n.intersectionPoints[n.intersectionPoints.length-1];if(r===t){var o=n.intersectionPoints[0];return e.push(o.p),o.incrementVisitCount(),o}return e.push(r.p),r.incrementVisitCount(),r}if(n.intersectionPoints.length>2&&n.intersectionPoints[0]!==t){var i=K(t,n.intersectionPoints),s=n.intersectionPoints[i-1];return e.push(s.p),s.incrementVisitCount(),s}for(var a=!0;a;){if(e.push(n.p1.p),void 0===(n=n.prevEdge).originalIndex)return t;n.intersectionPoints.length>0&&(a=!1)}if(void 0===n.originalIndex)return t;var u=n.intersectionPoints[n.intersectionPoints.length-1];return u.incrementVisitCount(),e.push(u.p),u}function tt(t,e){var n=t.polylineEdge;if(n.intersectionPoints.length>1&&n.intersectionPoints[n.intersectionPoints.length-1]!==t){var r=K(t,n.intersectionPoints),o=n.intersectionPoints[r+1];return e.push(o.p),o.incrementVisitCount(),o}for(var i=!0;i;){if(e.push(n.p2.p),null===(n=n.nextEdge))return t;n.intersectionPoints.length>0&&(i=!1)}if(void 0===n)return t;var s=n.intersectionPoints[0];return s.incrementVisitCount(),e.push(s.p),s}var et="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function nt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function rt(t){var e=t.default;if("function"==typeof e){var n=function(){return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var r=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,r.get?r:{enumerable:!0,get:function(){return t[e]}})})),n}var ot={exports:{}};!function(t,e){t.exports=function(){var t=function(t,e){var n={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},r={on:function(t,e,r){if(void 0===n[t])throw new Error("Invalid event type: "+t);n[t].push({selector:e,fn:r})},render:function(t){e.store.featureChanged(t)}},o=function(t,o){for(var i=n[t],s=i.length;s--;){var a=i[s];if(a.selector(o)){a.fn.call(r,o)||e.store.render(),e.ui.updateMapClasses();break}}};return t.start.call(r),{render:t.render,stop:function(){t.stop&&t.stop()},trash:function(){t.trash&&(t.trash(),e.store.render())},combineFeatures:function(){t.combineFeatures&&t.combineFeatures()},uncombineFeatures:function(){t.uncombineFeatures&&t.uncombineFeatures()},drag:function(t){o("drag",t)},click:function(t){o("click",t)},mousemove:function(t){o("mousemove",t)},mousedown:function(t){o("mousedown",t)},mouseup:function(t){o("mouseup",t)},mouseout:function(t){o("mouseout",t)},keydown:function(t){o("keydown",t)},keyup:function(t){o("keyup",t)},touchstart:function(t){o("touchstart",t)},touchmove:function(t){o("touchmove",t)},touchend:function(t){o("touchend",t)},tap:function(t){o("tap",t)}}};function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n(t){if(t.__esModule)return t;var e=t.default;if("function"==typeof e){var n=function t(){if(this instanceof t){var n=[null];return n.push.apply(n,arguments),new(Function.bind.apply(e,n))}return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var r=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,r.get?r:{enumerable:!0,get:function(){return t[e]}})})),n}var r={},o={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142};function i(t){var e=0;if(t&&t.length>0){e+=Math.abs(s(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(s(t[n]))}return e}function s(t){var e,n,r,i,s,u,l=0,c=t.length;if(c>2){for(u=0;u<c;u++)u===c-2?(r=c-2,i=c-1,s=0):u===c-1?(r=c-1,i=0,s=1):(r=u,i=u+1,s=u+2),e=t[r],n=t[i],l+=(a(t[s][0])-a(e[0]))*Math.sin(a(n[1]));l=l*o.RADIUS*o.RADIUS/2}return l}function a(t){return t*Math.PI/180}r.geometry=function t(e){var n,r=0;switch(e.type){case"Polygon":return i(e.coordinates);case"MultiPolygon":for(n=0;n<e.coordinates.length;n++)r+=i(e.coordinates[n]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<e.geometries.length;n++)r+=t(e.geometries[n]);return r}},r.ring=s;var u={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},l={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},c={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},f={POLYGON:"polygon",LINE:"line_string",POINT:"point"},h={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},p={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},d={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},g={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},y={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},v={ACTIVE:"true",INACTIVE:"false"},m=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],b=-85,E=Object.freeze({__proto__:null,classes:u,sources:l,cursors:c,types:f,geojsonTypes:h,modes:p,events:d,updateActions:g,meta:y,activeStates:v,interactions:m,LAT_MIN:-90,LAT_RENDERED_MIN:b,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),_={Point:0,LineString:1,MultiLineString:1,Polygon:2};function x(t,e){var n=_[t.geometry.type]-_[e.geometry.type];return 0===n&&t.geometry.type===h.POLYGON?t.area-e.area:n}function S(t){return t.map((function(t){return t.geometry.type===h.POLYGON&&(t.area=r.geometry({type:h.FEATURE,property:{},geometry:t.geometry})),t})).sort(x).map((function(t){return delete t.area,t}))}function w(t,e){return void 0===e&&(e=0),[[t.point.x-e,t.point.y-e],[t.point.x+e,t.point.y+e]]}function P(t){if(this._items={},this._nums={},this._length=t?t.length:0,t)for(var e=0,n=t.length;e<n;e++)this.add(t[e]),void 0!==t[e]&&("string"==typeof t[e]?this._items[t[e]]=e:this._nums[t[e]]=e)}P.prototype.add=function(t){return this.has(t)||(this._length++,"string"==typeof t?this._items[t]=this._length:this._nums[t]=this._length),this},P.prototype.delete=function(t){return!1===this.has(t)||(this._length--,delete this._items[t],delete this._nums[t]),this},P.prototype.has=function(t){return!("string"!=typeof t&&"number"!=typeof t||void 0===this._items[t]&&void 0===this._nums[t])},P.prototype.values=function(){var t=this,e=[];return Object.keys(this._items).forEach((function(n){e.push({k:n,v:t._items[n]})})),Object.keys(this._nums).forEach((function(n){e.push({k:JSON.parse(n),v:t._nums[n]})})),e.sort((function(t,e){return t.v-e.v})).map((function(t){return t.k}))},P.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var C=[y.FEATURE,y.MIDPOINT,y.VERTEX],M={click:function(t,e,n){return I(t,e,n,n.options.clickBuffer)},touch:function(t,e,n){return I(t,e,n,n.options.touchBuffer)}};function I(t,e,n,r){if(null===n.map)return[];var o=t?w(t,r):e,i={};n.options.styles&&(i.layers=n.options.styles.map((function(t){return t.id})).filter((function(t){return null!=n.map.getLayer(t)})));var s=n.map.queryRenderedFeatures(o,i).filter((function(t){return-1!==C.indexOf(t.properties.meta)})),a=new P,u=[];return s.forEach((function(t){var e=t.properties.id;a.has(e)||(a.add(e),u.push(t))})),S(u)}function O(t,e){var n=M.click(t,null,e),r={mouse:c.NONE};return n[0]&&(r.mouse=n[0].properties.active===v.ACTIVE?c.MOVE:c.POINTER,r.feature=n[0].properties.meta),-1!==e.events.currentModeName().indexOf("draw")&&(r.mouse=c.ADD),e.ui.queueMapClasses(r),e.ui.updateMapClasses(),n[0]}function T(t,e){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}function L(t,e,n){void 0===n&&(n={});var r=null!=n.fineTolerance?n.fineTolerance:4,o=null!=n.grossTolerance?n.grossTolerance:12,i=null!=n.interval?n.interval:500;t.point=t.point||e.point,t.time=t.time||e.time;var s=T(t.point,e.point);return s<r||s<o&&e.time-t.time<i}function F(t,e,n){void 0===n&&(n={});var r=null!=n.tolerance?n.tolerance:25,o=null!=n.interval?n.interval:250;return t.point=t.point||e.point,t.time=t.time||e.time,T(t.point,e.point)<r&&e.time-t.time<o}var k={exports:{}},N=k.exports=function(t,e){if(e||(e=16),void 0===t&&(t=128),t<=0)return"0";for(var n=Math.log(Math.pow(2,t))/Math.log(e),r=2;n===1/0;r*=2)n=Math.log(Math.pow(2,t/r))/Math.log(e)*r;var o=n-Math.floor(n),i="";for(r=0;r<Math.floor(n);r++)i=Math.floor(Math.random()*e).toString(e)+i;if(o){var s=Math.pow(e,o);i=Math.floor(Math.random()*s).toString(e)+i}var a=parseInt(i,e);return a!==1/0&&a>=Math.pow(2,t)?N(t,e):i};N.rack=function(t,e,n){var r=function(r){var i=0;do{if(i++>10){if(!n)throw new Error("too many ID collisions, use more bits");t+=n}var s=N(t,e)}while(Object.hasOwnProperty.call(o,s));return o[s]=r,s},o=r.hats={};return r.get=function(t){return r.hats[t]},r.set=function(t,e){return r.hats[t]=e,r},r.bits=t||128,r.base=e||16,r};var A=e(k.exports),R=function(t,e){this.ctx=t,this.properties=e.properties||{},this.coordinates=e.geometry.coordinates,this.id=e.id||A(),this.type=e.geometry.type};R.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},R.prototype.incomingCoords=function(t){this.setCoordinates(t)},R.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},R.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},R.prototype.setProperty=function(t,e){this.properties[t]=e},R.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:h.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},R.prototype.internal=function(t){var e={id:this.id,meta:y.FEATURE,"meta:type":this.type,active:v.INACTIVE,mode:t};if(this.ctx.options.userProperties)for(var n in this.properties)e["user_"+n]=this.properties[n];return{type:h.FEATURE,properties:e,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var D=function(t,e){R.call(this,t,e)};(D.prototype=Object.create(R.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},D.prototype.updateCoordinate=function(t,e,n){this.coordinates=3===arguments.length?[e,n]:[t,e],this.changed()},D.prototype.getCoordinate=function(){return this.getCoordinates()};var U=function(t,e){R.call(this,t,e)};(U.prototype=Object.create(R.prototype)).isValid=function(){return this.coordinates.length>1},U.prototype.addCoordinate=function(t,e,n){this.changed();var r=parseInt(t,10);this.coordinates.splice(r,0,[e,n])},U.prototype.getCoordinate=function(t){var e=parseInt(t,10);return JSON.parse(JSON.stringify(this.coordinates[e]))},U.prototype.removeCoordinate=function(t){this.changed(),this.coordinates.splice(parseInt(t,10),1)},U.prototype.updateCoordinate=function(t,e,n){var r=parseInt(t,10);this.coordinates[r]=[e,n],this.changed()};var j=function(t,e){R.call(this,t,e),this.coordinates=this.coordinates.map((function(t){return t.slice(0,-1)}))};(j.prototype=Object.create(R.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every((function(t){return t.length>2}))},j.prototype.incomingCoords=function(t){this.coordinates=t.map((function(t){return t.slice(0,-1)})),this.changed()},j.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},j.prototype.addCoordinate=function(t,e,n){this.changed();var r=t.split(".").map((function(t){return parseInt(t,10)}));this.coordinates[r[0]].splice(r[1],0,[e,n])},j.prototype.removeCoordinate=function(t){this.changed();var e=t.split(".").map((function(t){return parseInt(t,10)})),n=this.coordinates[e[0]];n&&(n.splice(e[1],1),n.length<3&&this.coordinates.splice(e[0],1))},j.prototype.getCoordinate=function(t){var e=t.split(".").map((function(t){return parseInt(t,10)})),n=this.coordinates[e[0]];return JSON.parse(JSON.stringify(n[e[1]]))},j.prototype.getCoordinates=function(){return this.coordinates.map((function(t){return t.concat([t[0]])}))},j.prototype.updateCoordinate=function(t,e,n){this.changed();var r=t.split("."),o=parseInt(r[0],10),i=parseInt(r[1],10);void 0===this.coordinates[o]&&(this.coordinates[o]=[]),this.coordinates[o][i]=[e,n]};var B={MultiPoint:D,MultiLineString:U,MultiPolygon:j},G=function(t,e,n,r,o){var i=n.split("."),s=parseInt(i[0],10),a=i[1]?i.slice(1).join("."):null;return t[s][e](a,r,o)},V=function(t,e){if(R.call(this,t,e),delete this.coordinates,this.model=B[e.geometry.type],void 0===this.model)throw new TypeError(e.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(e.geometry.coordinates)};function Y(t){this.map=t.map,this.drawConfig=JSON.parse(JSON.stringify(t.options||{})),this._ctx=t}(V.prototype=Object.create(R.prototype))._coordinatesToFeatures=function(t){var e=this,n=this.model.bind(this);return t.map((function(t){return new n(e.ctx,{id:A(),type:h.FEATURE,properties:{},geometry:{coordinates:t,type:e.type.replace("Multi","")}})}))},V.prototype.isValid=function(){return this.features.every((function(t){return t.isValid()}))},V.prototype.setCoordinates=function(t){this.features=this._coordinatesToFeatures(t),this.changed()},V.prototype.getCoordinate=function(t){return G(this.features,"getCoordinate",t)},V.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map((function(t){return t.type===h.POLYGON?t.getCoordinates():t.coordinates}))))},V.prototype.updateCoordinate=function(t,e,n){G(this.features,"updateCoordinate",t,e,n),this.changed()},V.prototype.addCoordinate=function(t,e,n){G(this.features,"addCoordinate",t,e,n),this.changed()},V.prototype.removeCoordinate=function(t){G(this.features,"removeCoordinate",t),this.changed()},V.prototype.getFeatures=function(){return this.features},Y.prototype.setSelected=function(t){return this._ctx.store.setSelected(t)},Y.prototype.setSelectedCoordinates=function(t){var e=this;this._ctx.store.setSelectedCoordinates(t),t.reduce((function(t,n){return void 0===t[n.feature_id]&&(t[n.feature_id]=!0,e._ctx.store.get(n.feature_id).changed()),t}),{})},Y.prototype.getSelected=function(){return this._ctx.store.getSelected()},Y.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Y.prototype.isSelected=function(t){return this._ctx.store.isSelected(t)},Y.prototype.getFeature=function(t){return this._ctx.store.get(t)},Y.prototype.select=function(t){return this._ctx.store.select(t)},Y.prototype.deselect=function(t){return this._ctx.store.deselect(t)},Y.prototype.deleteFeature=function(t,e){return void 0===e&&(e={}),this._ctx.store.delete(t,e)},Y.prototype.addFeature=function(t){return this._ctx.store.add(t)},Y.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Y.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Y.prototype.setActionableState=function(t){void 0===t&&(t={});var e={trash:t.trash||!1,combineFeatures:t.combineFeatures||!1,uncombineFeatures:t.uncombineFeatures||!1};return this._ctx.events.actionable(e)},Y.prototype.changeMode=function(t,e,n){return void 0===e&&(e={}),void 0===n&&(n={}),this._ctx.events.changeMode(t,e,n)},Y.prototype.updateUIClasses=function(t){return this._ctx.ui.queueMapClasses(t)},Y.prototype.activateUIButton=function(t){return this._ctx.ui.setActiveButton(t)},Y.prototype.featuresAt=function(t,e,n){if(void 0===n&&(n="click"),"click"!==n&&"touch"!==n)throw new Error("invalid buffer type");return M[n](t,e,this._ctx)},Y.prototype.newFeature=function(t){var e=t.geometry.type;return e===h.POINT?new D(this._ctx,t):e===h.LINE_STRING?new U(this._ctx,t):e===h.POLYGON?new j(this._ctx,t):new V(this._ctx,t)},Y.prototype.isInstanceOf=function(t,e){if(t===h.POINT)return e instanceof D;if(t===h.LINE_STRING)return e instanceof U;if(t===h.POLYGON)return e instanceof j;if("MultiFeature"===t)return e instanceof V;throw new Error("Unknown feature class: "+t)},Y.prototype.doRender=function(t){return this._ctx.store.featureChanged(t)},Y.prototype.onSetup=function(){},Y.prototype.onDrag=function(){},Y.prototype.onClick=function(){},Y.prototype.onMouseMove=function(){},Y.prototype.onMouseDown=function(){},Y.prototype.onMouseUp=function(){},Y.prototype.onMouseOut=function(){},Y.prototype.onKeyUp=function(){},Y.prototype.onKeyDown=function(){},Y.prototype.onTouchStart=function(){},Y.prototype.onTouchMove=function(){},Y.prototype.onTouchEnd=function(){},Y.prototype.onTap=function(){},Y.prototype.onStop=function(){},Y.prototype.onTrash=function(){},Y.prototype.onCombineFeature=function(){},Y.prototype.onUncombineFeature=function(){},Y.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var X={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},z=Object.keys(X);function q(t){var e=Object.keys(t);return function(n,r){void 0===r&&(r={});var o={},i=e.reduce((function(e,n){return e[n]=t[n],e}),new Y(n));return{start:function(){var e=this;o=i.onSetup(r),z.forEach((function(n){var r,s=X[n],a=function(){return!1};t[s]&&(a=function(){return!0}),e.on(n,a,(r=s,function(t){return i[r](o,t)}))}))},stop:function(){i.onStop(o)},trash:function(){i.onTrash(o)},combineFeatures:function(){i.onCombineFeatures(o)},uncombineFeatures:function(){i.onUncombineFeatures(o)},render:function(t,e){i.toDisplayFeatures(o,t,e)}}}}function J(t){return[].concat(t).filter((function(t){return void 0!==t}))}function $(){var t=this;if(!t.ctx.map||void 0===t.ctx.map.getSource(l.HOT))return u();var e=t.ctx.events.currentModeName();t.ctx.ui.queueMapClasses({mode:e});var n=[],r=[];t.isDirty?r=t.getAllIds():(n=t.getChangedIds().filter((function(e){return void 0!==t.get(e)})),r=t.sources.hot.filter((function(e){return e.properties.id&&-1===n.indexOf(e.properties.id)&&void 0!==t.get(e.properties.id)})).map((function(t){return t.properties.id}))),t.sources.hot=[];var o=t.sources.cold.length;t.sources.cold=t.isDirty?[]:t.sources.cold.filter((function(t){var e=t.properties.id||t.properties.parent;return-1===n.indexOf(e)}));var i=o!==t.sources.cold.length||r.length>0;function s(n,r){var o=t.get(n).internal(e);t.ctx.events.currentModeRender(o,(function(e){t.sources[r].push(e)}))}if(n.forEach((function(t){return s(t,"hot")})),r.forEach((function(t){return s(t,"cold")})),i&&t.ctx.map.getSource(l.COLD).setData({type:h.FEATURE_COLLECTION,features:t.sources.cold}),t.ctx.map.getSource(l.HOT).setData({type:h.FEATURE_COLLECTION,features:t.sources.hot}),t._emitSelectionChange&&(t.ctx.map.fire(d.SELECTION_CHANGE,{features:t.getSelected().map((function(t){return t.toGeoJSON()})),points:t.getSelectedCoordinates().map((function(t){return{type:h.FEATURE,properties:{},geometry:{type:h.POINT,coordinates:t.coordinates}}}))}),t._emitSelectionChange=!1),t._deletedFeaturesToEmit.length){var a=t._deletedFeaturesToEmit.map((function(t){return t.toGeoJSON()}));t._deletedFeaturesToEmit=[],t.ctx.map.fire(d.DELETE,{features:a})}function u(){t.isDirty=!1,t.clearChangedIds()}u(),t.ctx.map.fire(d.RENDER,{})}function W(t){var e,n=this;this._features={},this._featureIds=new P,this._selectedFeatureIds=new P,this._selectedCoordinates=[],this._changedFeatureIds=new P,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=t,this.sources={hot:[],cold:[]},this.render=function(){e||(e=requestAnimationFrame((function(){e=null,$.call(n)})))},this.isDirty=!1}function H(t,e){var n=t._selectedCoordinates.filter((function(e){return t._selectedFeatureIds.has(e.feature_id)}));t._selectedCoordinates.length===n.length||e.silent||(t._emitSelectionChange=!0),t._selectedCoordinates=n}W.prototype.createRenderBatch=function(){var t=this,e=this.render,n=0;return this.render=function(){n++},function(){t.render=e,n>0&&t.render()}},W.prototype.setDirty=function(){return this.isDirty=!0,this},W.prototype.featureChanged=function(t){return this._changedFeatureIds.add(t),this},W.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},W.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},W.prototype.getAllIds=function(){return this._featureIds.values()},W.prototype.add=function(t){return this.featureChanged(t.id),this._features[t.id]=t,this._featureIds.add(t.id),this},W.prototype.delete=function(t,e){var n=this;return void 0===e&&(e={}),J(t).forEach((function(t){n._featureIds.has(t)&&(n._featureIds.delete(t),n._selectedFeatureIds.delete(t),e.silent||-1===n._deletedFeaturesToEmit.indexOf(n._features[t])&&n._deletedFeaturesToEmit.push(n._features[t]),delete n._features[t],n.isDirty=!0)})),H(this,e),this},W.prototype.get=function(t){return this._features[t]},W.prototype.getAll=function(){var t=this;return Object.keys(this._features).map((function(e){return t._features[e]}))},W.prototype.select=function(t,e){var n=this;return void 0===e&&(e={}),J(t).forEach((function(t){n._selectedFeatureIds.has(t)||(n._selectedFeatureIds.add(t),n._changedFeatureIds.add(t),e.silent||(n._emitSelectionChange=!0))})),this},W.prototype.deselect=function(t,e){var n=this;return void 0===e&&(e={}),J(t).forEach((function(t){n._selectedFeatureIds.has(t)&&(n._selectedFeatureIds.delete(t),n._changedFeatureIds.add(t),e.silent||(n._emitSelectionChange=!0))})),H(this,e),this},W.prototype.clearSelected=function(t){return void 0===t&&(t={}),this.deselect(this._selectedFeatureIds.values(),{silent:t.silent}),this},W.prototype.setSelected=function(t,e){var n=this;return void 0===e&&(e={}),t=J(t),this.deselect(this._selectedFeatureIds.values().filter((function(e){return-1===t.indexOf(e)})),{silent:e.silent}),this.select(t.filter((function(t){return!n._selectedFeatureIds.has(t)})),{silent:e.silent}),this},W.prototype.setSelectedCoordinates=function(t){return this._selectedCoordinates=t,this._emitSelectionChange=!0,this},W.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},W.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},W.prototype.getSelected=function(){var t=this;return this._selectedFeatureIds.values().map((function(e){return t.get(e)}))},W.prototype.getSelectedCoordinates=function(){var t=this;return this._selectedCoordinates.map((function(e){return{coordinates:t.get(e.feature_id).getCoordinate(e.coord_path)}}))},W.prototype.isSelected=function(t){return this._selectedFeatureIds.has(t)},W.prototype.setFeatureProperty=function(t,e,n){this.get(t).setProperty(e,n),this.featureChanged(t)},W.prototype.storeMapConfig=function(){var t=this;m.forEach((function(e){t.ctx.map[e]&&(t._mapInitialConfig[e]=t.ctx.map[e].isEnabled())}))},W.prototype.restoreMapConfig=function(){var t=this;Object.keys(this._mapInitialConfig).forEach((function(e){t._mapInitialConfig[e]?t.ctx.map[e].enable():t.ctx.map[e].disable()}))},W.prototype.getInitialConfigValue=function(t){return void 0===this._mapInitialConfig[t]||this._mapInitialConfig[t]};var Z=function(){for(var t=arguments,e={},n=0;n<arguments.length;n++){var r=t[n];for(var o in r)K.call(r,o)&&(e[o]=r[o])}return e},K=Object.prototype.hasOwnProperty,Q=e(Z),tt=["mode","feature","mouse"];function nt(e){var n=null,r=null,o={onRemove:function(){return e.map.off("load",o.connect),clearInterval(r),o.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,n&&n.parentNode&&n.parentNode.removeChild(n),n=null,this},connect:function(){e.map.off("load",o.connect),clearInterval(r),o.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd:function(i){var s=i.fire;return i.fire=function(t,e){var n=arguments;return 1===s.length&&1!==arguments.length&&(n=[Q({},{type:t},e)]),s.apply(i,n)},e.map=i,e.events=function(e){var n=Object.keys(e.options.modes).reduce((function(t,n){return t[n]=q(e.options.modes[n]),t}),{}),r={},o={},i={},s=null,a=null;i.drag=function(t,n){n({point:t.point,time:(new Date).getTime()})?(e.ui.queueMapClasses({mouse:c.DRAG}),a.drag(t)):t.originalEvent.stopPropagation()},i.mousedrag=function(t){i.drag(t,(function(t){return!L(r,t)}))},i.touchdrag=function(t){i.drag(t,(function(t){return!F(o,t)}))},i.mousemove=function(t){if(1===(void 0!==t.originalEvent.buttons?t.originalEvent.buttons:t.originalEvent.which))return i.mousedrag(t);var n=O(t,e);t.featureTarget=n,a.mousemove(t)},i.mousedown=function(t){r={time:(new Date).getTime(),point:t.point};var n=O(t,e);t.featureTarget=n,a.mousedown(t)},i.mouseup=function(t){var n=O(t,e);t.featureTarget=n,L(r,{point:t.point,time:(new Date).getTime()})?a.click(t):a.mouseup(t)},i.mouseout=function(t){a.mouseout(t)},i.touchstart=function(t){if(e.options.touchEnabled){o={time:(new Date).getTime(),point:t.point};var n=M.touch(t,null,e)[0];t.featureTarget=n,a.touchstart(t)}},i.touchmove=function(t){if(e.options.touchEnabled)return a.touchmove(t),i.touchdrag(t)},i.touchend=function(t){if(t.originalEvent.preventDefault(),e.options.touchEnabled){var n=M.touch(t,null,e)[0];t.featureTarget=n,F(o,{time:(new Date).getTime(),point:t.point})?a.tap(t):a.touchend(t)}};var u=function(t){return!(8===t||46===t||t>=48&&t<=57)};function l(r,o,i){void 0===i&&(i={}),a.stop();var u=n[r];if(void 0===u)throw new Error(r+" is not valid");s=r;var l=u(e,o);a=t(l,e),i.silent||e.map.fire(d.MODE_CHANGE,{mode:r}),e.store.setDirty(),e.store.render()}i.keydown=function(t){(t.srcElement||t.target).classList.contains("mapboxgl-canvas")&&(8!==t.keyCode&&46!==t.keyCode||!e.options.controls.trash?u(t.keyCode)?a.keydown(t):49===t.keyCode&&e.options.controls.point?l(p.DRAW_POINT):50===t.keyCode&&e.options.controls.line_string?l(p.DRAW_LINE_STRING):51===t.keyCode&&e.options.controls.polygon&&l(p.DRAW_POLYGON):(t.preventDefault(),a.trash()))},i.keyup=function(t){u(t.keyCode)&&a.keyup(t)},i.zoomend=function(){e.store.changeZoom()},i.data=function(t){if("style"===t.dataType){var n=e.setup,r=e.map,o=e.options,i=e.store;o.styles.some((function(t){return r.getLayer(t.id)}))||(n.addLayers(),i.setDirty(),i.render())}};var f={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){s=e.options.defaultMode,a=t(n[s](e),e)},changeMode:l,actionable:function(t){var n=!1;Object.keys(t).forEach((function(e){if(void 0===f[e])throw new Error("Invalid action type");f[e]!==t[e]&&(n=!0),f[e]=t[e]})),n&&e.map.fire(d.ACTIONABLE,{actions:f})},currentModeName:function(){return s},currentModeRender:function(t,e){return a.render(t,e)},fire:function(t,e){i[t]&&i[t](e)},addEventListeners:function(){e.map.on("mousemove",i.mousemove),e.map.on("mousedown",i.mousedown),e.map.on("mouseup",i.mouseup),e.map.on("data",i.data),e.map.on("touchmove",i.touchmove),e.map.on("touchstart",i.touchstart),e.map.on("touchend",i.touchend),e.container.addEventListener("mouseout",i.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",i.keydown),e.container.addEventListener("keyup",i.keyup))},removeEventListeners:function(){e.map.off("mousemove",i.mousemove),e.map.off("mousedown",i.mousedown),e.map.off("mouseup",i.mouseup),e.map.off("data",i.data),e.map.off("touchmove",i.touchmove),e.map.off("touchstart",i.touchstart),e.map.off("touchend",i.touchend),e.container.removeEventListener("mouseout",i.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",i.keydown),e.container.removeEventListener("keyup",i.keyup))},trash:function(t){a.trash(t)},combineFeatures:function(){a.combineFeatures()},uncombineFeatures:function(){a.uncombineFeatures()},getMode:function(){return s}}}(e),e.ui=function(t){var e={},n=null,r={mode:null,feature:null,mouse:null},o={mode:null,feature:null,mouse:null};function i(t){o=Q(o,t)}function s(){var e,n;if(t.container){var i=[],s=[];tt.forEach((function(t){o[t]!==r[t]&&(i.push(t+"-"+r[t]),null!==o[t]&&s.push(t+"-"+o[t]))})),i.length>0&&(e=t.container.classList).remove.apply(e,i),s.length>0&&(n=t.container.classList).add.apply(n,s),r=Q(r,o)}}function a(t,e){void 0===e&&(e={});var r=document.createElement("button");return r.className=u.CONTROL_BUTTON+" "+e.className,r.setAttribute("title",e.title),e.container.appendChild(r),r.addEventListener("click",(function(r){if(r.preventDefault(),r.stopPropagation(),r.target===n)return l(),void e.onDeactivate();c(t),e.onActivate()}),!0),r}function l(){n&&(n.classList.remove(u.ACTIVE_BUTTON),n=null)}function c(t){l();var r=e[t];r&&r&&"trash"!==t&&(r.classList.add(u.ACTIVE_BUTTON),n=r)}return{setActiveButton:c,queueMapClasses:i,updateMapClasses:s,clearMapClasses:function(){i({mode:null,feature:null,mouse:null}),s()},addButtons:function(){var n=t.options.controls,r=document.createElement("div");return r.className=u.CONTROL_GROUP+" "+u.CONTROL_BASE,n?(n[f.LINE]&&(e[f.LINE]=a(f.LINE,{container:r,className:u.CONTROL_BUTTON_LINE,title:"LineString tool "+(t.options.keybindings?"(l)":""),onActivate:function(){return t.events.changeMode(p.DRAW_LINE_STRING)},onDeactivate:function(){return t.events.trash()}})),n[f.POLYGON]&&(e[f.POLYGON]=a(f.POLYGON,{container:r,className:u.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(t.options.keybindings?"(p)":""),onActivate:function(){return t.events.changeMode(p.DRAW_POLYGON)},onDeactivate:function(){return t.events.trash()}})),n[f.POINT]&&(e[f.POINT]=a(f.POINT,{container:r,className:u.CONTROL_BUTTON_POINT,title:"Marker tool "+(t.options.keybindings?"(m)":""),onActivate:function(){return t.events.changeMode(p.DRAW_POINT)},onDeactivate:function(){return t.events.trash()}})),n.trash&&(e.trash=a("trash",{container:r,className:u.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){t.events.trash()}})),n.combine_features&&(e.combine_features=a("combineFeatures",{container:r,className:u.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){t.events.combineFeatures()}})),n.uncombine_features&&(e.uncombine_features=a("uncombineFeatures",{container:r,className:u.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){t.events.uncombineFeatures()}})),r):r},removeButtons:function(){Object.keys(e).forEach((function(t){var n=e[t];n.parentNode&&n.parentNode.removeChild(n),delete e[t]}))}}}(e),e.container=i.getContainer(),e.store=new W(e),n=e.ui.addButtons(),e.options.boxSelect&&(e.boxZoomInitial=i.boxZoom.isEnabled(),i.boxZoom.disable(),i.dragPan.disable(),i.dragPan.enable()),i.loaded()?o.connect():(i.on("load",o.connect),r=setInterval((function(){i.loaded()&&o.connect()}),16)),e.events.start(),n},addLayers:function(){e.map.addSource(l.COLD,{data:{type:h.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(l.HOT,{data:{type:h.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach((function(t){e.map.addLayer(t)})),e.store.setDirty(!0),e.store.render()},removeLayers:function(){e.options.styles.forEach((function(t){e.map.getLayer(t.id)&&e.map.removeLayer(t.id)})),e.map.getSource(l.COLD)&&e.map.removeSource(l.COLD),e.map.getSource(l.HOT)&&e.map.removeSource(l.HOT)}};return e.setup=o,o}var rt=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function ot(t){return function(e){var n=e.featureTarget;return!!n&&!!n.properties&&n.properties.meta===t}}function it(t){return!!t.originalEvent&&!!t.originalEvent.shiftKey&&0===t.originalEvent.button}function st(t){return!!t.featureTarget&&!!t.featureTarget.properties&&t.featureTarget.properties.active===v.ACTIVE&&t.featureTarget.properties.meta===y.FEATURE}function at(t){return!!t.featureTarget&&!!t.featureTarget.properties&&t.featureTarget.properties.active===v.INACTIVE&&t.featureTarget.properties.meta===y.FEATURE}function ut(t){return void 0===t.featureTarget}function lt(t){return!!t.featureTarget&&!!t.featureTarget.properties&&t.featureTarget.properties.meta===y.FEATURE}function ct(t){var e=t.featureTarget;return!!e&&!!e.properties&&e.properties.meta===y.VERTEX}function ft(t){return!!t.originalEvent&&!0===t.originalEvent.shiftKey}function ht(t){return 27===t.keyCode}function pt(t){return 13===t.keyCode}var dt=Object.freeze({__proto__:null,isOfMetaType:ot,isShiftMousedown:it,isActiveFeature:st,isInactiveFeature:at,noTarget:ut,isFeature:lt,isVertex:ct,isShiftDown:ft,isEscapeKey:ht,isEnterKey:pt,isTrue:function(){return!0}}),gt=yt;function yt(t,e){this.x=t,this.y=e}yt.prototype={clone:function(){return new yt(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.x-n*this.y,o=n*this.x+e*this.y;return this.x=r,this.y=o,this},_rotateAround:function(t,e){var n=Math.cos(t),r=Math.sin(t),o=e.x+n*(this.x-e.x)-r*(this.y-e.y),i=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=o,this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},yt.convert=function(t){return t instanceof yt?t:Array.isArray(t)?new yt(t[0],t[1]):t};var vt=e(gt);function mt(t,e){var n=e.getBoundingClientRect();return new vt(t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0))}function bt(t,e,n,r){return{type:h.FEATURE,properties:{meta:y.VERTEX,parent:t,coord_path:n,active:r?v.ACTIVE:v.INACTIVE},geometry:{type:h.POINT,coordinates:e}}}function Et(t,e,n){var r=e.geometry.coordinates,o=n.geometry.coordinates;if(r[1]>85||r[1]<b||o[1]>85||o[1]<b)return null;var i={lng:(r[0]+o[0])/2,lat:(r[1]+o[1])/2};return{type:h.FEATURE,properties:{meta:y.MIDPOINT,parent:t,lng:i.lng,lat:i.lat,coord_path:n.properties.coord_path},geometry:{type:h.POINT,coordinates:[i.lng,i.lat]}}}function _t(t,e,n){void 0===e&&(e={}),void 0===n&&(n=null);var r,o=t.geometry,i=o.type,s=o.coordinates,a=t.properties&&t.properties.id,u=[];function l(t,n){var r="",o=null;t.forEach((function(t,i){var s=null!=n?n+"."+i:String(i),l=bt(a,t,s,c(s));if(e.midpoints&&o){var f=Et(a,o,l);f&&u.push(f)}o=l;var h=JSON.stringify(t);r!==h&&u.push(l),0===i&&(r=h)}))}function c(t){return!!e.selectedPaths&&-1!==e.selectedPaths.indexOf(t)}return i===h.POINT?u.push(bt(a,s,n,c(n))):i===h.POLYGON?s.forEach((function(t,e){l(t,null!==n?n+"."+e:String(e))})):i===h.LINE_STRING?l(s,n):0===i.indexOf(h.MULTI_PREFIX)&&(r=i.replace(h.MULTI_PREFIX,""),s.forEach((function(n,o){var i={type:h.FEATURE,properties:t.properties,geometry:{type:r,coordinates:n}};u=u.concat(_t(i,e,o))}))),u}var xt={enable:function(t){setTimeout((function(){t.map&&t.map.doubleClickZoom&&t._ctx&&t._ctx.store&&t._ctx.store.getInitialConfigValue&&t._ctx.store.getInitialConfigValue("doubleClickZoom")&&t.map.doubleClickZoom.enable()}),0)},disable:function(t){setTimeout((function(){t.map&&t.map.doubleClickZoom&&t.map.doubleClickZoom.disable()}),0)}},St={exports:{}},wt=function(t){if(!t||!t.type)return null;var e=Pt[t.type];return e?"geometry"===e?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:t}]}:"feature"===e?{type:"FeatureCollection",features:[t]}:"featurecollection"===e?t:void 0:null},Pt={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Ct=e(wt),Mt=Object.freeze({__proto__:null,default:function t(e){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.reduce((function(e,n){return e.concat(t(n))}),[]),e;case"Feature":return e.geometry?t(e.geometry).map((function(t){var n={type:"Feature",properties:JSON.parse(JSON.stringify(e.properties)),geometry:t};return void 0!==e.id&&(n.id=e.id),n})):[e];case"MultiPoint":return e.coordinates.map((function(t){return{type:"Point",coordinates:t}}));case"MultiPolygon":return e.coordinates.map((function(t){return{type:"Polygon",coordinates:t}}));case"MultiLineString":return e.coordinates.map((function(t){return{type:"LineString",coordinates:t}}));case"GeometryCollection":return e.geometries.map(t).reduce((function(t,e){return t.concat(e)}),[]);case"Point":case"Polygon":case"LineString":return[e]}}}),It=wt,Ot=n(Mt),Tt=function(t){return function t(e){return Array.isArray(e)&&e.length&&"number"==typeof e[0]?[e]:e.reduce((function(e,n){return Array.isArray(n)&&Array.isArray(n[0])?e.concat(t(n)):(e.push(n),e)}),[])}(t)};Ot instanceof Function||(Ot=Ot.default);var Lt={exports:{}},Ft=Lt.exports=function(t){return new kt(t)};function kt(t){this.value=t}function Nt(t,e,n){var r=[],o=[],i=!0;return function t(s){var a=n?At(s):s,u={},l=!0,c={node:a,node_:s,path:[].concat(r),parent:o[o.length-1],parents:o,key:r.slice(-1)[0],isRoot:0===r.length,level:r.length,circular:null,update:function(t,e){c.isRoot||(c.parent.node[c.key]=t),c.node=t,e&&(l=!1)},delete:function(t){delete c.parent.node[c.key],t&&(l=!1)},remove:function(t){Ut(c.parent.node)?c.parent.node.splice(c.key,1):delete c.parent.node[c.key],t&&(l=!1)},keys:null,before:function(t){u.before=t},after:function(t){u.after=t},pre:function(t){u.pre=t},post:function(t){u.post=t},stop:function(){i=!1},block:function(){l=!1}};if(!i)return c;function f(){if("object"==typeof c.node&&null!==c.node){c.keys&&c.node_===c.node||(c.keys=Rt(c.node)),c.isLeaf=0==c.keys.length;for(var t=0;t<o.length;t++)if(o[t].node_===s){c.circular=o[t];break}}else c.isLeaf=!0,c.keys=null;c.notLeaf=!c.isLeaf,c.notRoot=!c.isRoot}f();var h=e.call(c,c.node);return void 0!==h&&c.update&&c.update(h),u.before&&u.before.call(c,c.node),l?("object"!=typeof c.node||null===c.node||c.circular||(o.push(c),f(),jt(c.keys,(function(e,o){r.push(e),u.pre&&u.pre.call(c,c.node[e],e);var i=t(c.node[e]);n&&Bt.call(c.node,e)&&(c.node[e]=i.node),i.isLast=o==c.keys.length-1,i.isFirst=0==o,u.post&&u.post.call(c,i),r.pop()})),o.pop()),u.after&&u.after.call(c,c.node),c):c}(t).node}function At(t){if("object"==typeof t&&null!==t){var e;if(Ut(t))e=[];else if("[object Date]"===Dt(t))e=new Date(t.getTime?t.getTime():t);else if(function(t){return"[object RegExp]"===Dt(t)}(t))e=new RegExp(t);else if(function(t){return"[object Error]"===Dt(t)}(t))e={message:t.message};else if(function(t){return"[object Boolean]"===Dt(t)}(t))e=new Boolean(t);else if(function(t){return"[object Number]"===Dt(t)}(t))e=new Number(t);else if(function(t){return"[object String]"===Dt(t)}(t))e=new String(t);else if(Object.create&&Object.getPrototypeOf)e=Object.create(Object.getPrototypeOf(t));else if(t.constructor===Object)e={};else{var n=t.constructor&&t.constructor.prototype||t.__proto__||{},r=function(){};r.prototype=n,e=new r}return jt(Rt(t),(function(n){e[n]=t[n]})),e}return t}kt.prototype.get=function(t){for(var e=this.value,n=0;n<t.length;n++){var r=t[n];if(!e||!Bt.call(e,r)){e=void 0;break}e=e[r]}return e},kt.prototype.has=function(t){for(var e=this.value,n=0;n<t.length;n++){var r=t[n];if(!e||!Bt.call(e,r))return!1;e=e[r]}return!0},kt.prototype.set=function(t,e){for(var n=this.value,r=0;r<t.length-1;r++){var o=t[r];Bt.call(n,o)||(n[o]={}),n=n[o]}return n[t[r]]=e,e},kt.prototype.map=function(t){return Nt(this.value,t,!0)},kt.prototype.forEach=function(t){return this.value=Nt(this.value,t,!1),this.value},kt.prototype.reduce=function(t,e){var n=1===arguments.length,r=n?this.value:e;return this.forEach((function(e){this.isRoot&&n||(r=t.call(this,r,e))})),r},kt.prototype.paths=function(){var t=[];return this.forEach((function(e){t.push(this.path)})),t},kt.prototype.nodes=function(){var t=[];return this.forEach((function(e){t.push(this.node)})),t},kt.prototype.clone=function(){var t=[],e=[];return function n(r){for(var o=0;o<t.length;o++)if(t[o]===r)return e[o];if("object"==typeof r&&null!==r){var i=At(r);return t.push(r),e.push(i),jt(Rt(r),(function(t){i[t]=n(r[t])})),t.pop(),e.pop(),i}return r}(this.value)};var Rt=Object.keys||function(t){var e=[];for(var n in t)e.push(n);return e};function Dt(t){return Object.prototype.toString.call(t)}var Ut=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},jt=function(t,e){if(t.forEach)return t.forEach(e);for(var n=0;n<t.length;n++)e(t[n],n,t)};jt(Rt(kt.prototype),(function(t){Ft[t]=function(e){var n=[].slice.call(arguments,1),r=new kt(e);return r[t].apply(r,n)}}));var Bt=Object.hasOwnProperty||function(t,e){return e in t},Gt=Lt.exports,Vt=Yt;function Yt(t){if(!(this instanceof Yt))return new Yt(t);this._bbox=t||[1/0,1/0,-1/0,-1/0],this._valid=!!t}Yt.prototype.include=function(t){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[0]),this._bbox[3]=Math.max(this._bbox[3],t[1]),this},Yt.prototype.equals=function(t){var e;return e=t instanceof Yt?t.bbox():t,this._bbox[0]==e[0]&&this._bbox[1]==e[1]&&this._bbox[2]==e[2]&&this._bbox[3]==e[3]},Yt.prototype.center=function(t){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Yt.prototype.union=function(t){var e;return this._valid=!0,e=t instanceof Yt?t.bbox():t,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[2]),this._bbox[3]=Math.max(this._bbox[3],e[3]),this},Yt.prototype.bbox=function(){return this._valid?this._bbox:null},Yt.prototype.contains=function(t){if(!t)return this._fastContains();if(!this._valid)return null;var e=t[0],n=t[1];return this._bbox[0]<=e&&this._bbox[1]<=n&&this._bbox[2]>=e&&this._bbox[3]>=n},Yt.prototype.intersect=function(t){return this._valid?(e=t instanceof Yt?t.bbox():t,!(this._bbox[0]>e[2]||this._bbox[2]<e[0]||this._bbox[3]<e[1]||this._bbox[1]>e[3])):null;var e},Yt.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var t="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",t)},Yt.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Xt=function(t){if(!t)return[];var e=Ot(It(t)),n=[];return e.features.forEach((function(t){t.geometry&&(n=n.concat(Tt(t.geometry.coordinates)))})),n},zt=Gt,qt=Vt,Jt={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},$t=Object.keys(Jt);function Wt(t){for(var e=qt(),n=Xt(t),r=0;r<n.length;r++)e.include(n[r]);return e}St.exports=function(t){return Wt(t).bbox()},St.exports.polygon=function(t){return Wt(t).polygon()},St.exports.bboxify=function(t){return zt(t).map((function(t){t&&$t.some((function(e){return!!t[e]&&-1!==Jt[e].indexOf(t.type)}))&&(t.bbox=Wt(t).bbox(),this.update(t))}))};var Ht=e(St.exports),Zt=-90;function Kt(t,e){var n=Zt,r=90,o=Zt,i=90,s=270,a=-270;t.forEach((function(t){var e=Ht(t),u=e[1],l=e[3],c=e[0],f=e[2];u>n&&(n=u),l<r&&(r=l),l>o&&(o=l),u<i&&(i=u),c<s&&(s=c),f>a&&(a=f)}));var u=e;return n+u.lat>85&&(u.lat=85-n),o+u.lat>90&&(u.lat=90-o),r+u.lat<-85&&(u.lat=-85-r),i+u.lat<Zt&&(u.lat=Zt-i),s+u.lng<=-270&&(u.lng+=360*Math.ceil(Math.abs(u.lng)/360)),a+u.lng>=270&&(u.lng-=360*Math.ceil(Math.abs(u.lng)/360)),u}function Qt(t,e){var n=Kt(t.map((function(t){return t.toGeoJSON()})),e);t.forEach((function(t){var e,r=t.getCoordinates(),o=function(t){var e={lng:t[0]+n.lng,lat:t[1]+n.lat};return[e.lng,e.lat]},i=function(t){return t.map((function(t){return o(t)}))};t.type===h.POINT?e=o(r):t.type===h.LINE_STRING||t.type===h.MULTI_POINT?e=r.map(o):t.type===h.POLYGON||t.type===h.MULTI_LINE_STRING?e=r.map(i):t.type===h.MULTI_POLYGON&&(e=r.map((function(t){return t.map((function(t){return i(t)}))}))),t.incomingCoords(e)}))}var te={onSetup:function(t){var e=this,n={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:t.featureIds||[]};return this.setSelected(n.initiallySelectedFeatureIds.filter((function(t){return void 0!==e.getFeature(t)}))),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),n},fireUpdate:function(){this.map.fire(d.UPDATE,{action:g.MOVE,features:this.getSelected().map((function(t){return t.toGeoJSON()}))})},fireActionable:function(){var t=this,e=this.getSelected(),n=e.filter((function(e){return t.isInstanceOf("MultiFeature",e)})),r=!1;if(e.length>1){r=!0;var o=e[0].type.replace("Multi","");e.forEach((function(t){t.type.replace("Multi","")!==o&&(r=!1)}))}var i=n.length>0,s=e.length>0;this.setActionableState({combineFeatures:r,uncombineFeatures:i,trash:s})},getUniqueIds:function(t){return t.length?t.map((function(t){return t.properties.id})).filter((function(t){return void 0!==t})).reduce((function(t,e){return t.add(e),t}),new P).values():[]},stopExtendedInteractions:function(t){t.boxSelectElement&&(t.boxSelectElement.parentNode&&t.boxSelectElement.parentNode.removeChild(t.boxSelectElement),t.boxSelectElement=null),this.map.dragPan.enable(),t.boxSelecting=!1,t.canBoxSelect=!1,t.dragMoving=!1,t.canDragMove=!1},onStop:function(){xt.enable(this)},onMouseMove:function(t,e){return lt(e)&&t.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(t),!0},onMouseOut:function(t){return!t.dragMoving||this.fireUpdate()}};te.onTap=te.onClick=function(t,e){return ut(e)?this.clickAnywhere(t,e):ot(y.VERTEX)(e)?this.clickOnVertex(t,e):lt(e)?this.clickOnFeature(t,e):void 0},te.clickAnywhere=function(t){var e=this,n=this.getSelectedIds();n.length&&(this.clearSelectedFeatures(),n.forEach((function(t){return e.doRender(t)}))),xt.enable(this),this.stopExtendedInteractions(t)},te.clickOnVertex=function(t,e){this.changeMode(p.DIRECT_SELECT,{featureId:e.featureTarget.properties.parent,coordPath:e.featureTarget.properties.coord_path,startPos:e.lngLat}),this.updateUIClasses({mouse:c.MOVE})},te.startOnActiveFeature=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),this.doRender(e.featureTarget.properties.id),t.canDragMove=!0,t.dragMoveLocation=e.lngLat},te.clickOnFeature=function(t,e){var n=this;xt.disable(this),this.stopExtendedInteractions(t);var r=ft(e),o=this.getSelectedIds(),i=e.featureTarget.properties.id,s=this.isSelected(i);if(!r&&s&&this.getFeature(i).type!==h.POINT)return this.changeMode(p.DIRECT_SELECT,{featureId:i});s&&r?(this.deselect(i),this.updateUIClasses({mouse:c.POINTER}),1===o.length&&xt.enable(this)):!s&&r?(this.select(i),this.updateUIClasses({mouse:c.MOVE})):s||r||(o.forEach((function(t){return n.doRender(t)})),this.setSelected(i),this.updateUIClasses({mouse:c.MOVE})),this.doRender(i)},te.onMouseDown=function(t,e){return st(e)?this.startOnActiveFeature(t,e):this.drawConfig.boxSelect&&it(e)?this.startBoxSelect(t,e):void 0},te.startBoxSelect=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),t.boxSelectStartLocation=mt(e.originalEvent,this.map.getContainer()),t.canBoxSelect=!0},te.onTouchStart=function(t,e){if(st(e))return this.startOnActiveFeature(t,e)},te.onDrag=function(t,e){return t.canDragMove?this.dragMove(t,e):this.drawConfig.boxSelect&&t.canBoxSelect?this.whileBoxSelect(t,e):void 0},te.whileBoxSelect=function(t,e){t.boxSelecting=!0,this.updateUIClasses({mouse:c.ADD}),t.boxSelectElement||(t.boxSelectElement=document.createElement("div"),t.boxSelectElement.classList.add(u.BOX_SELECT),this.map.getContainer().appendChild(t.boxSelectElement));var n=mt(e.originalEvent,this.map.getContainer()),r=Math.min(t.boxSelectStartLocation.x,n.x),o=Math.max(t.boxSelectStartLocation.x,n.x),i=Math.min(t.boxSelectStartLocation.y,n.y),s=Math.max(t.boxSelectStartLocation.y,n.y),a="translate("+r+"px, "+i+"px)";t.boxSelectElement.style.transform=a,t.boxSelectElement.style.WebkitTransform=a,t.boxSelectElement.style.width=o-r+"px",t.boxSelectElement.style.height=s-i+"px"},te.dragMove=function(t,e){t.dragMoving=!0,e.originalEvent.stopPropagation();var n={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};Qt(this.getSelected(),n),t.dragMoveLocation=e.lngLat},te.onTouchEnd=te.onMouseUp=function(t,e){var n=this;if(t.dragMoving)this.fireUpdate();else if(t.boxSelecting){var r=[t.boxSelectStartLocation,mt(e.originalEvent,this.map.getContainer())],o=this.featuresAt(null,r,"click"),i=this.getUniqueIds(o).filter((function(t){return!n.isSelected(t)}));i.length&&(this.select(i),i.forEach((function(t){return n.doRender(t)})),this.updateUIClasses({mouse:c.MOVE}))}this.stopExtendedInteractions(t)},te.toDisplayFeatures=function(t,e,n){e.properties.active=this.isSelected(e.properties.id)?v.ACTIVE:v.INACTIVE,n(e),this.fireActionable(),e.properties.active===v.ACTIVE&&e.geometry.type!==h.POINT&&_t(e).forEach(n)},te.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},te.onCombineFeatures=function(){var t=this.getSelected();if(!(0===t.length||t.length<2)){for(var e=[],n=[],r=t[0].type.replace("Multi",""),o=0;o<t.length;o++){var i=t[o];if(i.type.replace("Multi","")!==r)return;i.type.includes("Multi")?i.getCoordinates().forEach((function(t){e.push(t)})):e.push(i.getCoordinates()),n.push(i.toGeoJSON())}if(n.length>1){var s=this.newFeature({type:h.FEATURE,properties:n[0].properties,geometry:{type:"Multi"+r,coordinates:e}});this.addFeature(s),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([s.id]),this.map.fire(d.COMBINE_FEATURES,{createdFeatures:[s.toGeoJSON()],deletedFeatures:n})}this.fireActionable()}},te.onUncombineFeatures=function(){var t=this,e=this.getSelected();if(0!==e.length){for(var n=[],r=[],o=function(o){var i=e[o];t.isInstanceOf("MultiFeature",i)&&(i.getFeatures().forEach((function(e){t.addFeature(e),e.properties=i.properties,n.push(e.toGeoJSON()),t.select([e.id])})),t.deleteFeature(i.id,{silent:!0}),r.push(i.toGeoJSON()))},i=0;i<e.length;i++)o(i);n.length>1&&this.map.fire(d.UNCOMBINE_FEATURES,{createdFeatures:n,deletedFeatures:r}),this.fireActionable()}};var ee=ot(y.VERTEX),ne=ot(y.MIDPOINT),re={fireUpdate:function(){this.map.fire(d.UPDATE,{action:g.CHANGE_COORDINATES,features:this.getSelected().map((function(t){return t.toGeoJSON()}))})},fireActionable:function(t){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:t.selectedCoordPaths.length>0})},startDragging:function(t,e){this.map.dragPan.disable(),t.canDragMove=!0,t.dragMoveLocation=e.lngLat},stopDragging:function(t){this.map.dragPan.enable(),t.dragMoving=!1,t.canDragMove=!1,t.dragMoveLocation=null},onVertex:function(t,e){this.startDragging(t,e);var n=e.featureTarget.properties,r=t.selectedCoordPaths.indexOf(n.coord_path);ft(e)||-1!==r?ft(e)&&-1===r&&t.selectedCoordPaths.push(n.coord_path):t.selectedCoordPaths=[n.coord_path];var o=this.pathsToCoordinates(t.featureId,t.selectedCoordPaths);this.setSelectedCoordinates(o)},onMidpoint:function(t,e){this.startDragging(t,e);var n=e.featureTarget.properties;t.feature.addCoordinate(n.coord_path,n.lng,n.lat),this.fireUpdate(),t.selectedCoordPaths=[n.coord_path]},pathsToCoordinates:function(t,e){return e.map((function(e){return{feature_id:t,coord_path:e}}))},onFeature:function(t,e){0===t.selectedCoordPaths.length?this.startDragging(t,e):this.stopDragging(t)},dragFeature:function(t,e,n){Qt(this.getSelected(),n),t.dragMoveLocation=e.lngLat},dragVertex:function(t,e,n){for(var r=t.selectedCoordPaths.map((function(e){return t.feature.getCoordinate(e)})),o=Kt(r.map((function(t){return{type:h.FEATURE,properties:{},geometry:{type:h.POINT,coordinates:t}}})),n),i=0;i<r.length;i++){var s=r[i];t.feature.updateCoordinate(t.selectedCoordPaths[i],s[0]+o.lng,s[1]+o.lat)}},clickNoTarget:function(){this.changeMode(p.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(p.SIMPLE_SELECT)},clickActiveFeature:function(t){t.selectedCoordPaths=[],this.clearSelectedCoordinates(),t.feature.changed()},onSetup:function(t){var e=t.featureId,n=this.getFeature(e);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===h.POINT)throw new TypeError("direct_select mode doesn't handle point features");var r={featureId:e,feature:n,dragMoveLocation:t.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:t.coordPath?[t.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(e,r.selectedCoordPaths)),this.setSelected(e),xt.disable(this),this.setActionableState({trash:!0}),r},onStop:function(){xt.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(t,e,n){t.featureId===e.properties.id?(e.properties.active=v.ACTIVE,n(e),_t(e,{map:this.map,midpoints:!0,selectedPaths:t.selectedCoordPaths}).forEach(n)):(e.properties.active=v.INACTIVE,n(e)),this.fireActionable(t)},onTrash:function(t){t.selectedCoordPaths.sort((function(t,e){return e.localeCompare(t,"en",{numeric:!0})})).forEach((function(e){return t.feature.removeCoordinate(e)})),this.fireUpdate(),t.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(t),!1===t.feature.isValid()&&(this.deleteFeature([t.featureId]),this.changeMode(p.SIMPLE_SELECT,{}))},onMouseMove:function(t,e){var n=st(e),r=ee(e),o=ne(e),i=0===t.selectedCoordPaths.length;return n&&i||r&&!i?this.updateUIClasses({mouse:c.MOVE}):this.updateUIClasses({mouse:c.NONE}),(r||n||o)&&t.dragMoving&&this.fireUpdate(),this.stopDragging(t),!0},onMouseOut:function(t){return t.dragMoving&&this.fireUpdate(),!0}};re.onTouchStart=re.onMouseDown=function(t,e){return ee(e)?this.onVertex(t,e):st(e)?this.onFeature(t,e):ne(e)?this.onMidpoint(t,e):void 0},re.onDrag=function(t,e){if(!0===t.canDragMove){t.dragMoving=!0,e.originalEvent.stopPropagation();var n={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};t.selectedCoordPaths.length>0?this.dragVertex(t,e,n):this.dragFeature(t,e,n),t.dragMoveLocation=e.lngLat}},re.onClick=function(t,e){return ut(e)?this.clickNoTarget(t,e):st(e)?this.clickActiveFeature(t,e):at(e)?this.clickInactive(t,e):void this.stopDragging(t)},re.onTap=function(t,e){return ut(e)?this.clickNoTarget(t,e):st(e)?this.clickActiveFeature(t,e):at(e)?this.clickInactive(t,e):void 0},re.onTouchEnd=re.onMouseUp=function(t){t.dragMoving&&this.fireUpdate(),this.stopDragging(t)};var oe={};function ie(t,e){return!!t.lngLat&&t.lngLat.lng===e[0]&&t.lngLat.lat===e[1]}oe.onSetup=function(){var t=this.newFeature({type:h.FEATURE,properties:{},geometry:{type:h.POINT,coordinates:[]}});return this.addFeature(t),this.clearSelectedFeatures(),this.updateUIClasses({mouse:c.ADD}),this.activateUIButton(f.POINT),this.setActionableState({trash:!0}),{point:t}},oe.stopDrawingAndRemove=function(t){this.deleteFeature([t.point.id],{silent:!0}),this.changeMode(p.SIMPLE_SELECT)},oe.onTap=oe.onClick=function(t,e){this.updateUIClasses({mouse:c.MOVE}),t.point.updateCoordinate("",e.lngLat.lng,e.lngLat.lat),this.map.fire(d.CREATE,{features:[t.point.toGeoJSON()]}),this.changeMode(p.SIMPLE_SELECT,{featureIds:[t.point.id]})},oe.onStop=function(t){this.activateUIButton(),t.point.getCoordinate().length||this.deleteFeature([t.point.id],{silent:!0})},oe.toDisplayFeatures=function(t,e,n){var r=e.properties.id===t.point.id;if(e.properties.active=r?v.ACTIVE:v.INACTIVE,!r)return n(e)},oe.onTrash=oe.stopDrawingAndRemove,oe.onKeyUp=function(t,e){if(ht(e)||pt(e))return this.stopDrawingAndRemove(t,e)};var se={onSetup:function(){var t=this.newFeature({type:h.FEATURE,properties:{},geometry:{type:h.POLYGON,coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),xt.disable(this),this.updateUIClasses({mouse:c.ADD}),this.activateUIButton(f.POLYGON),this.setActionableState({trash:!0}),{polygon:t,currentVertexPosition:0}},clickAnywhere:function(t,e){if(t.currentVertexPosition>0&&ie(e,t.polygon.coordinates[0][t.currentVertexPosition-1]))return this.changeMode(p.SIMPLE_SELECT,{featureIds:[t.polygon.id]});this.updateUIClasses({mouse:c.ADD}),t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),t.currentVertexPosition++,t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(p.SIMPLE_SELECT,{featureIds:[t.polygon.id]})},onMouseMove:function(t,e){t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),ct(e)&&this.updateUIClasses({mouse:c.POINTER})}};se.onTap=se.onClick=function(t,e){return ct(e)?this.clickOnVertex(t,e):this.clickAnywhere(t,e)},se.onKeyUp=function(t,e){ht(e)?(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(p.SIMPLE_SELECT)):pt(e)&&this.changeMode(p.SIMPLE_SELECT,{featureIds:[t.polygon.id]})},se.onStop=function(t){this.updateUIClasses({mouse:c.NONE}),xt.enable(this),this.activateUIButton(),void 0!==this.getFeature(t.polygon.id)&&(t.polygon.removeCoordinate("0."+t.currentVertexPosition),t.polygon.isValid()?this.map.fire(d.CREATE,{features:[t.polygon.toGeoJSON()]}):(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(p.SIMPLE_SELECT,{},{silent:!0})))},se.toDisplayFeatures=function(t,e,n){var r=e.properties.id===t.polygon.id;if(e.properties.active=r?v.ACTIVE:v.INACTIVE,!r)return n(e);if(0!==e.geometry.coordinates.length){var o=e.geometry.coordinates[0].length;if(!(o<3)){if(e.properties.meta=y.FEATURE,n(bt(t.polygon.id,e.geometry.coordinates[0][0],"0.0",!1)),o>3){var i=e.geometry.coordinates[0].length-3;n(bt(t.polygon.id,e.geometry.coordinates[0][i],"0."+i,!1))}if(o<=4){var s=[[e.geometry.coordinates[0][0][0],e.geometry.coordinates[0][0][1]],[e.geometry.coordinates[0][1][0],e.geometry.coordinates[0][1][1]]];if(n({type:h.FEATURE,properties:e.properties,geometry:{coordinates:s,type:h.LINE_STRING}}),3===o)return}return n(e)}}},se.onTrash=function(t){this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(p.SIMPLE_SELECT)};var ae={onSetup:function(t){var e,n,r=(t=t||{}).featureId,o="forward";if(r){if(!(e=this.getFeature(r)))throw new Error("Could not find a feature with the provided featureId");var i=t.from;if(i&&"Feature"===i.type&&i.geometry&&"Point"===i.geometry.type&&(i=i.geometry),i&&"Point"===i.type&&i.coordinates&&2===i.coordinates.length&&(i=i.coordinates),!i||!Array.isArray(i))throw new Error("Please use the `from` property to indicate which point to continue the line from");var s=e.coordinates.length-1;if(e.coordinates[s][0]===i[0]&&e.coordinates[s][1]===i[1])n=s+1,e.addCoordinate.apply(e,[n].concat(e.coordinates[s]));else{if(e.coordinates[0][0]!==i[0]||e.coordinates[0][1]!==i[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");o="backwards",n=0,e.addCoordinate.apply(e,[n].concat(e.coordinates[0]))}}else e=this.newFeature({type:h.FEATURE,properties:{},geometry:{type:h.LINE_STRING,coordinates:[]}}),n=0,this.addFeature(e);return this.clearSelectedFeatures(),xt.disable(this),this.updateUIClasses({mouse:c.ADD}),this.activateUIButton(f.LINE),this.setActionableState({trash:!0}),{line:e,currentVertexPosition:n,direction:o}},clickAnywhere:function(t,e){if(t.currentVertexPosition>0&&ie(e,t.line.coordinates[t.currentVertexPosition-1])||"backwards"===t.direction&&ie(e,t.line.coordinates[t.currentVertexPosition+1]))return this.changeMode(p.SIMPLE_SELECT,{featureIds:[t.line.id]});this.updateUIClasses({mouse:c.ADD}),t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),"forward"===t.direction?(t.currentVertexPosition++,t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)):t.line.addCoordinate(0,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(p.SIMPLE_SELECT,{featureIds:[t.line.id]})},onMouseMove:function(t,e){t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),ct(e)&&this.updateUIClasses({mouse:c.POINTER})}};ae.onTap=ae.onClick=function(t,e){if(ct(e))return this.clickOnVertex(t,e);this.clickAnywhere(t,e)},ae.onKeyUp=function(t,e){pt(e)?this.changeMode(p.SIMPLE_SELECT,{featureIds:[t.line.id]}):ht(e)&&(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(p.SIMPLE_SELECT))},ae.onStop=function(t){xt.enable(this),this.activateUIButton(),void 0!==this.getFeature(t.line.id)&&(t.line.removeCoordinate(""+t.currentVertexPosition),t.line.isValid()?this.map.fire(d.CREATE,{features:[t.line.toGeoJSON()]}):(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(p.SIMPLE_SELECT,{},{silent:!0})))},ae.onTrash=function(t){this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(p.SIMPLE_SELECT)},ae.toDisplayFeatures=function(t,e,n){var r=e.properties.id===t.line.id;if(e.properties.active=r?v.ACTIVE:v.INACTIVE,!r)return n(e);e.geometry.coordinates.length<2||(e.properties.meta=y.FEATURE,n(bt(t.line.id,e.geometry.coordinates["forward"===t.direction?e.geometry.coordinates.length-2:1],""+("forward"===t.direction?e.geometry.coordinates.length-2:1),!1)),n(e))};var ue={simple_select:te,direct_select:re,draw_point:oe,draw_polygon:se,draw_line_string:ae},le={defaultMode:p.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:rt,modes:ue,controls:{},userProperties:!1},ce={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},fe={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function he(t,e){return t.map((function(t){return t.source?t:Q(t,{id:t.id+"."+e,source:"hot"===e?l.HOT:l.COLD})}))}var pe={exports:{}};!function(t,e){var n="__lodash_hash_undefined__",r=9007199254740991,o="[object Arguments]",i="[object Array]",s="[object Boolean]",a="[object Date]",u="[object Error]",l="[object Function]",c="[object Map]",f="[object Number]",h="[object Object]",p="[object Promise]",d="[object RegExp]",g="[object Set]",y="[object String]",v="[object Symbol]",m="[object WeakMap]",b="[object ArrayBuffer]",E="[object DataView]",_=/^\[object .+?Constructor\]$/,x=/^(?:0|[1-9]\d*)$/,S={};S["[object Float32Array]"]=S["[object Float64Array]"]=S["[object Int8Array]"]=S["[object Int16Array]"]=S["[object Int32Array]"]=S["[object Uint8Array]"]=S["[object Uint8ClampedArray]"]=S["[object Uint16Array]"]=S["[object Uint32Array]"]=!0,S[o]=S[i]=S[b]=S[s]=S[E]=S[a]=S[u]=S[l]=S[c]=S[f]=S[h]=S[d]=S[g]=S[y]=S[m]=!1;var w="object"==typeof et&&et&&et.Object===Object&&et,P="object"==typeof self&&self&&self.Object===Object&&self,C=w||P||Function("return this")(),M=e&&!e.nodeType&&e,I=M&&t&&!t.nodeType&&t,O=I&&I.exports===M,T=O&&w.process,L=function(){try{return T&&T.binding&&T.binding("util")}catch(t){}}(),F=L&&L.isTypedArray;function k(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function N(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function A(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var R,D,U,j=Array.prototype,B=Function.prototype,G=Object.prototype,V=C["__core-js_shared__"],Y=B.toString,X=G.hasOwnProperty,z=(R=/[^.]+$/.exec(V&&V.keys&&V.keys.IE_PROTO||""))?"Symbol(src)_1."+R:"",q=G.toString,J=RegExp("^"+Y.call(X).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),$=O?C.Buffer:void 0,W=C.Symbol,H=C.Uint8Array,Z=G.propertyIsEnumerable,K=j.splice,Q=W?W.toStringTag:void 0,tt=Object.getOwnPropertySymbols,nt=$?$.isBuffer:void 0,rt=(D=Object.keys,U=Object,function(t){return D(U(t))}),ot=Ft(C,"DataView"),it=Ft(C,"Map"),st=Ft(C,"Promise"),at=Ft(C,"Set"),ut=Ft(C,"WeakMap"),lt=Ft(Object,"create"),ct=Rt(ot),ft=Rt(it),ht=Rt(st),pt=Rt(at),dt=Rt(ut),gt=W?W.prototype:void 0,yt=gt?gt.valueOf:void 0;function vt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function mt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function bt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Et(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new bt;++e<n;)this.add(t[e])}function _t(t){var e=this.__data__=new mt(t);this.size=e.size}function xt(t,e){var n=jt(t),r=!n&&Ut(t),o=!n&&!r&&Bt(t),i=!n&&!r&&!o&&zt(t),s=n||r||o||i,a=s?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],u=a.length;for(var l in t)!e&&!X.call(t,l)||s&&("length"==l||o&&("offset"==l||"parent"==l)||i&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||At(l,u))||a.push(l);return a}function St(t,e){for(var n=t.length;n--;)if(Dt(t[n][0],e))return n;return-1}function wt(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Q&&Q in Object(t)?function(t){var e=X.call(t,Q),n=t[Q];try{t[Q]=void 0;var r=!0}catch(t){}var o=q.call(t);return r&&(e?t[Q]=n:delete t[Q]),o}(t):function(t){return q.call(t)}(t)}function Pt(t){return Xt(t)&&wt(t)==o}function Ct(t,e,n,r,l){return t===e||(null==t||null==e||!Xt(t)&&!Xt(e)?t!=t&&e!=e:function(t,e,n,r,l,p){var m=jt(t),_=jt(e),x=m?i:Nt(t),S=_?i:Nt(e),w=(x=x==o?h:x)==h,P=(S=S==o?h:S)==h,C=x==S;if(C&&Bt(t)){if(!Bt(e))return!1;m=!0,w=!1}if(C&&!w)return p||(p=new _t),m||zt(t)?Ot(t,e,n,r,l,p):function(t,e,n,r,o,i,l){switch(n){case E:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case b:return!(t.byteLength!=e.byteLength||!i(new H(t),new H(e)));case s:case a:case f:return Dt(+t,+e);case u:return t.name==e.name&&t.message==e.message;case d:case y:return t==e+"";case c:var h=N;case g:var p=1&r;if(h||(h=A),t.size!=e.size&&!p)return!1;var m=l.get(t);if(m)return m==e;r|=2,l.set(t,e);var _=Ot(h(t),h(e),r,o,i,l);return l.delete(t),_;case v:if(yt)return yt.call(t)==yt.call(e)}return!1}(t,e,x,n,r,l,p);if(!(1&n)){var M=w&&X.call(t,"__wrapped__"),I=P&&X.call(e,"__wrapped__");if(M||I){var O=M?t.value():t,T=I?e.value():e;return p||(p=new _t),l(O,T,n,r,p)}}return!!C&&(p||(p=new _t),function(t,e,n,r,o,i){var s=1&n,a=Tt(t),u=a.length;if(u!=Tt(e).length&&!s)return!1;for(var l=u;l--;){var c=a[l];if(!(s?c in e:X.call(e,c)))return!1}var f=i.get(t);if(f&&i.get(e))return f==e;var h=!0;i.set(t,e),i.set(e,t);for(var p=s;++l<u;){var d=t[c=a[l]],g=e[c];if(r)var y=s?r(g,d,c,e,t,i):r(d,g,c,t,e,i);if(!(void 0===y?d===g||o(d,g,n,r,i):y)){h=!1;break}p||(p="constructor"==c)}if(h&&!p){var v=t.constructor,m=e.constructor;v==m||!("constructor"in t)||!("constructor"in e)||"function"==typeof v&&v instanceof v&&"function"==typeof m&&m instanceof m||(h=!1)}return i.delete(t),i.delete(e),h}(t,e,n,r,l,p))}(t,e,n,r,Ct,l))}function Mt(t){return!(!Yt(t)||function(t){return!!z&&z in t}(t))&&(Gt(t)?J:_).test(Rt(t))}function It(t){if(n=(e=t)&&e.constructor,e!==("function"==typeof n&&n.prototype||G))return rt(t);var e,n,r=[];for(var o in Object(t))X.call(t,o)&&"constructor"!=o&&r.push(o);return r}function Ot(t,e,n,r,o,i){var s=1&n,a=t.length,u=e.length;if(a!=u&&!(s&&u>a))return!1;var l=i.get(t);if(l&&i.get(e))return l==e;var c=-1,f=!0,h=2&n?new Et:void 0;for(i.set(t,e),i.set(e,t);++c<a;){var p=t[c],d=e[c];if(r)var g=s?r(d,p,c,e,t,i):r(p,d,c,t,e,i);if(void 0!==g){if(g)continue;f=!1;break}if(h){if(!k(e,(function(t,e){if(s=e,!h.has(s)&&(p===t||o(p,t,n,r,i)))return h.push(e);var s}))){f=!1;break}}else if(p!==d&&!o(p,d,n,r,i)){f=!1;break}}return i.delete(t),i.delete(e),f}function Tt(t){return function(t,e,n){var r=e(t);return jt(t)?r:function(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t}(r,n(t))}(t,qt,kt)}function Lt(t,e){var n,r,o=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof e?"string":"hash"]:o.map}function Ft(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return Mt(n)?n:void 0}vt.prototype.clear=function(){this.__data__=lt?lt(null):{},this.size=0},vt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},vt.prototype.get=function(t){var e=this.__data__;if(lt){var r=e[t];return r===n?void 0:r}return X.call(e,t)?e[t]:void 0},vt.prototype.has=function(t){var e=this.__data__;return lt?void 0!==e[t]:X.call(e,t)},vt.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=lt&&void 0===e?n:e,this},mt.prototype.clear=function(){this.__data__=[],this.size=0},mt.prototype.delete=function(t){var e=this.__data__,n=St(e,t);return!(n<0||(n==e.length-1?e.pop():K.call(e,n,1),--this.size,0))},mt.prototype.get=function(t){var e=this.__data__,n=St(e,t);return n<0?void 0:e[n][1]},mt.prototype.has=function(t){return St(this.__data__,t)>-1},mt.prototype.set=function(t,e){var n=this.__data__,r=St(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},bt.prototype.clear=function(){this.size=0,this.__data__={hash:new vt,map:new(it||mt),string:new vt}},bt.prototype.delete=function(t){var e=Lt(this,t).delete(t);return this.size-=e?1:0,e},bt.prototype.get=function(t){return Lt(this,t).get(t)},bt.prototype.has=function(t){return Lt(this,t).has(t)},bt.prototype.set=function(t,e){var n=Lt(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},Et.prototype.add=Et.prototype.push=function(t){return this.__data__.set(t,n),this},Et.prototype.has=function(t){return this.__data__.has(t)},_t.prototype.clear=function(){this.__data__=new mt,this.size=0},_t.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},_t.prototype.get=function(t){return this.__data__.get(t)},_t.prototype.has=function(t){return this.__data__.has(t)},_t.prototype.set=function(t,e){var n=this.__data__;if(n instanceof mt){var r=n.__data__;if(!it||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new bt(r)}return n.set(t,e),this.size=n.size,this};var kt=tt?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,r=null==t?0:t.length,o=0,i=[];++n<r;){var s=t[n];e(s,n,t)&&(i[o++]=s)}return i}(tt(t),(function(e){return Z.call(t,e)})))}:function(){return[]},Nt=wt;function At(t,e){return!!(e=null==e?r:e)&&("number"==typeof t||x.test(t))&&t>-1&&t%1==0&&t<e}function Rt(t){if(null!=t){try{return Y.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Dt(t,e){return t===e||t!=t&&e!=e}(ot&&Nt(new ot(new ArrayBuffer(1)))!=E||it&&Nt(new it)!=c||st&&Nt(st.resolve())!=p||at&&Nt(new at)!=g||ut&&Nt(new ut)!=m)&&(Nt=function(t){var e=wt(t),n=e==h?t.constructor:void 0,r=n?Rt(n):"";if(r)switch(r){case ct:return E;case ft:return c;case ht:return p;case pt:return g;case dt:return m}return e});var Ut=Pt(function(){return arguments}())?Pt:function(t){return Xt(t)&&X.call(t,"callee")&&!Z.call(t,"callee")},jt=Array.isArray,Bt=nt||function(){return!1};function Gt(t){if(!Yt(t))return!1;var e=wt(t);return e==l||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}function Vt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=r}function Yt(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Xt(t){return null!=t&&"object"==typeof t}var zt=F?function(t){return function(e){return t(e)}}(F):function(t){return Xt(t)&&Vt(t.length)&&!!S[wt(t)]};function qt(t){return null!=(e=t)&&Vt(e.length)&&!Gt(e)?xt(t):It(t);var e}t.exports=function(t,e){return Ct(t,e)}}(pe,pe.exports);var de=e(pe.exports);function ge(t,e){return t.length===e.length&&JSON.stringify(t.map((function(t){return t})).sort())===JSON.stringify(e.map((function(t){return t})).sort())}var ye={Polygon:j,LineString:U,Point:D,MultiPolygon:V,MultiLineString:V,MultiPoint:V},ve=Object.freeze({__proto__:null,CommonSelectors:dt,constrainFeatureMovement:Kt,createMidPoint:Et,createSupplementaryPoints:_t,createVertex:bt,doubleClickZoom:xt,euclideanDistance:T,featuresAt:M,getFeatureAtAndSetCursors:O,isClick:L,isEventAtCoordinates:ie,isTap:F,mapEventToBoundingBox:w,ModeHandler:t,moveFeatures:Qt,sortFeatures:S,stringSetsAreEqual:ge,StringSet:P,theme:rt,toDenseArray:J}),me=function(t,e){var n={options:t=function(t){void 0===t&&(t={});var e=Q(t);return t.controls||(e.controls={}),!1===t.displayControlsDefault?e.controls=Q(fe,t.controls):e.controls=Q(ce,t.controls),(e=Q(le,e)).styles=he(e.styles,"cold").concat(he(e.styles,"hot")),e}(t)};e=function(t,e){return e.modes=p,e.getFeatureIdsAt=function(e){return M.click({point:e},null,t).map((function(t){return t.properties.id}))},e.getSelectedIds=function(){return t.store.getSelectedIds()},e.getSelected=function(){return{type:h.FEATURE_COLLECTION,features:t.store.getSelectedIds().map((function(e){return t.store.get(e)})).map((function(t){return t.toGeoJSON()}))}},e.getSelectedPoints=function(){return{type:h.FEATURE_COLLECTION,features:t.store.getSelectedCoordinates().map((function(t){return{type:h.FEATURE,properties:{},geometry:{type:h.POINT,coordinates:t.coordinates}}}))}},e.set=function(n){if(void 0===n.type||n.type!==h.FEATURE_COLLECTION||!Array.isArray(n.features))throw new Error("Invalid FeatureCollection");var r=t.store.createRenderBatch(),o=t.store.getAllIds().slice(),i=e.add(n),s=new P(i);return(o=o.filter((function(t){return!s.has(t)}))).length&&e.delete(o),r(),i},e.add=function(e){var n=JSON.parse(JSON.stringify(Ct(e))).features.map((function(e){if(e.id=e.id||A(),null===e.geometry)throw new Error("Invalid geometry: null");if(void 0===t.store.get(e.id)||t.store.get(e.id).type!==e.geometry.type){var n=ye[e.geometry.type];if(void 0===n)throw new Error("Invalid geometry type: "+e.geometry.type+".");var r=new n(t,e);t.store.add(r)}else{var o=t.store.get(e.id);o.properties=e.properties,de(o.properties,e.properties)||t.store.featureChanged(o.id),de(o.getCoordinates(),e.geometry.coordinates)||o.incomingCoords(e.geometry.coordinates)}return e.id}));return t.store.render(),n},e.get=function(e){var n=t.store.get(e);if(n)return n.toGeoJSON()},e.getAll=function(){return{type:h.FEATURE_COLLECTION,features:t.store.getAll().map((function(t){return t.toGeoJSON()}))}},e.delete=function(n){return t.store.delete(n,{silent:!0}),e.getMode()!==p.DIRECT_SELECT||t.store.getSelectedIds().length?t.store.render():t.events.changeMode(p.SIMPLE_SELECT,void 0,{silent:!0}),e},e.deleteAll=function(){return t.store.delete(t.store.getAllIds(),{silent:!0}),e.getMode()===p.DIRECT_SELECT?t.events.changeMode(p.SIMPLE_SELECT,void 0,{silent:!0}):t.store.render(),e},e.changeMode=function(n,r){return void 0===r&&(r={}),n===p.SIMPLE_SELECT&&e.getMode()===p.SIMPLE_SELECT?(ge(r.featureIds||[],t.store.getSelectedIds())||(t.store.setSelected(r.featureIds,{silent:!0}),t.store.render()),e):(n===p.DIRECT_SELECT&&e.getMode()===p.DIRECT_SELECT&&r.featureId===t.store.getSelectedIds()[0]||t.events.changeMode(n,r,{silent:!0}),e)},e.getMode=function(){return t.events.getMode()},e.trash=function(){return t.events.trash({silent:!0}),e},e.combineFeatures=function(){return t.events.combineFeatures({silent:!0}),e},e.uncombineFeatures=function(){return t.events.uncombineFeatures({silent:!0}),e},e.setFeatureProperty=function(n,r,o){return t.store.setFeatureProperty(n,r,o),e},e}(n,e),n.api=e;var r=nt(n);return e.onAdd=r.onAdd,e.onRemove=r.onRemove,e.types=f,e.options=t,e};function be(t){me(t,this)}return be.modes=ue,be.constants=E,be.lib=ve,be}()}(ot);var it=nt(ot.exports);function st(t){if(!t)throw new Error("geojson is required");var e=[];return S(t,(function(t){!function(t,e){var n=[],r=t.geometry;if(null!==r){switch(r.type){case"Polygon":n=v(r);break;case"LineString":n=[v(r)]}n.forEach((function(n){var r=function(t,e){var n=[];return t.reduce((function(t,r){var o,i,s,a,u,l,f=c([t,r],e);return f.bbox=(i=r,s=(o=t)[0],a=o[1],u=i[0],l=i[1],[s<u?s:u,a<l?a:l,s>u?s:u,a>l?a:l]),n.push(f),r})),n}(n,t.properties);r.forEach((function(t){t.id=e.length,e.push(t)}))}))}}(t,e)})),f(e)}var at={exports:{}};function ut(t,e,n,r,o){lt(t,e,n||0,r||t.length-1,o||ft)}function lt(t,e,n,r,o){for(;r>n;){if(r-n>600){var i=r-n+1,s=e-n+1,a=Math.log(i),u=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*u*(i-u)/i)*(s-i/2<0?-1:1);lt(t,e,Math.max(n,Math.floor(e-s*u/i+l)),Math.min(r,Math.floor(e+(i-s)*u/i+l)),o)}var c=t[e],f=n,h=r;for(ct(t,n,e),o(t[r],c)>0&&ct(t,n,r);f<h;){for(ct(t,f,h),f++,h--;o(t[f],c)<0;)f++;for(;o(t[h],c)>0;)h--}0===o(t[n],c)?ct(t,n,h):ct(t,++h,r),h<=e&&(n=h+1),e<=h&&(r=h-1)}}function ct(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function ft(t,e){return t<e?-1:t>e?1:0}function ht(t,e,n){if(!n)return e.indexOf(t);for(let r=0;r<e.length;r++)if(n(t,e[r]))return r;return-1}function pt(t,e){dt(t,0,t.children.length,e,t)}function dt(t,e,n,r,o){o||(o=St(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(let i=e;i<n;i++){const e=t.children[i];gt(o,t.leaf?r(e):e)}return o}function gt(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function yt(t,e){return t.minX-e.minX}function vt(t,e){return t.minY-e.minY}function mt(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function bt(t){return t.maxX-t.minX+(t.maxY-t.minY)}function Et(t,e){const n=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),o=Math.min(t.maxX,e.maxX),i=Math.min(t.maxY,e.maxY);return Math.max(0,o-n)*Math.max(0,i-r)}function _t(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function xt(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function St(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function wt(t,e,n,r,o){const i=[e,n];for(;i.length;){if((n=i.pop())-(e=i.pop())<=r)continue;const s=e+Math.ceil((n-e)/r/2)*r;ut(t,s,e,n,o),i.push(e,s,s,n)}}var Pt=Object.freeze({__proto__:null,default:class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const n=[];if(!xt(t,e))return n;const r=this.toBBox,o=[];for(;e;){for(let i=0;i<e.children.length;i++){const s=e.children[i],a=e.leaf?r(s):s;xt(t,a)&&(e.leaf?n.push(s):_t(t,a)?this._all(s,n):o.push(s))}e=o.pop()}return n}collides(t){let e=this.data;if(!xt(t,e))return!1;const n=[];for(;e;){for(let r=0;r<e.children.length;r++){const o=e.children[r],i=e.leaf?this.toBBox(o):o;if(xt(t,i)){if(e.leaf||_t(t,i))return!0;n.push(o)}}e=n.pop()}return!1}load(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(let e=0;e<t.length;e++)this.insert(t[e]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const t=this.data;this.data=e,e=t}this._insert(e,this.data.height-e.height-1,!0)}else this.data=e;return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=St([]),this}remove(t,e){if(!t)return this;let n=this.data;const r=this.toBBox(t),o=[],i=[];let s,a,u;for(;n||o.length;){if(n||(n=o.pop(),a=o[o.length-1],s=i.pop(),u=!0),n.leaf){const r=ht(t,n.children,e);if(-1!==r)return n.children.splice(r,1),o.push(n),this._condense(o),this}u||n.leaf||!_t(n,r)?a?(s++,n=a.children[s],u=!1):n=null:(o.push(n),i.push(s),s=0,a=n,n=n.children[0])}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const n=[];for(;t;)t.leaf?e.push(...t.children):n.push(...t.children),t=n.pop();return e}_build(t,e,n,r){const o=n-e+1;let i,s=this._maxEntries;if(o<=s)return i=St(t.slice(e,n+1)),pt(i,this.toBBox),i;r||(r=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,r-1))),i=St([]),i.leaf=!1,i.height=r;const a=Math.ceil(o/s),u=a*Math.ceil(Math.sqrt(s));wt(t,e,n,u,this.compareMinX);for(let o=e;o<=n;o+=u){const e=Math.min(o+u-1,n);wt(t,o,e,a,this.compareMinY);for(let n=o;n<=e;n+=a){const o=Math.min(n+a-1,e);i.children.push(this._build(t,n,o,r-1))}}return pt(i,this.toBBox),i}_chooseSubtree(t,e,n,r){for(;r.push(e),!e.leaf&&r.length-1!==n;){let n,r=1/0,s=1/0;for(let a=0;a<e.children.length;a++){const u=e.children[a],l=mt(u),c=(o=t,i=u,(Math.max(i.maxX,o.maxX)-Math.min(i.minX,o.minX))*(Math.max(i.maxY,o.maxY)-Math.min(i.minY,o.minY))-l);c<s?(s=c,r=l<r?l:r,n=u):c===s&&l<r&&(r=l,n=u)}e=n||e.children[0]}var o,i;return e}_insert(t,e,n){const r=n?t:this.toBBox(t),o=[],i=this._chooseSubtree(r,this.data,e,o);for(i.children.push(t),gt(i,r);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(r,o,e)}_split(t,e){const n=t[e],r=n.children.length,o=this._minEntries;this._chooseSplitAxis(n,o,r);const i=this._chooseSplitIndex(n,o,r),s=St(n.children.splice(i,n.children.length-i));s.height=n.height,s.leaf=n.leaf,pt(n,this.toBBox),pt(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)}_splitRoot(t,e){this.data=St([t,e]),this.data.height=t.height+1,this.data.leaf=!1,pt(this.data,this.toBBox)}_chooseSplitIndex(t,e,n){let r,o=1/0,i=1/0;for(let s=e;s<=n-e;s++){const e=dt(t,0,s,this.toBBox),a=dt(t,s,n,this.toBBox),u=Et(e,a),l=mt(e)+mt(a);u<o?(o=u,r=s,i=l<i?l:i):u===o&&l<i&&(i=l,r=s)}return r||n-e}_chooseSplitAxis(t,e,n){const r=t.leaf?this.compareMinX:yt,o=t.leaf?this.compareMinY:vt;this._allDistMargin(t,e,n,r)<this._allDistMargin(t,e,n,o)&&t.children.sort(r)}_allDistMargin(t,e,n,r){t.children.sort(r);const o=this.toBBox,i=dt(t,0,e,o),s=dt(t,n-e,n,o);let a=bt(i)+bt(s);for(let r=e;r<n-e;r++){const e=t.children[r];gt(i,t.leaf?o(e):e),a+=bt(i)}for(let r=n-e-1;r>=e;r--){const e=t.children[r];gt(s,t.leaf?o(e):e),a+=bt(s)}return a}_adjustParentBBoxes(t,e,n){for(let r=n;r>=0;r--)gt(e[r],t)}_condense(t){for(let e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children,e.splice(e.indexOf(t[n]),1)):this.clear():pt(t[n],this.toBBox)}}}),Ct=rt(Pt),Mt={};!function(t){function e(t,e,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function n(t,n,r){if(void 0===r&&(r={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!h(t[0])||!h(t[1]))throw new Error("coordinates must contain numbers");return e({type:"Point",coordinates:t},n,r)}function r(t,n,r){void 0===r&&(r={});for(var o=0,i=t;o<i.length;o++){var s=i[o];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<s[s.length-1].length;a++)if(s[s.length-1][a]!==s[0][a])throw new Error("First and last Position are not equivalent.")}return e({type:"Polygon",coordinates:t},n,r)}function o(t,n,r){if(void 0===r&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return e({type:"LineString",coordinates:t},n,r)}function i(t,e){void 0===e&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function s(t,n,r){return void 0===r&&(r={}),e({type:"MultiLineString",coordinates:t},n,r)}function a(t,n,r){return void 0===r&&(r={}),e({type:"MultiPoint",coordinates:t},n,r)}function u(t,n,r){return void 0===r&&(r={}),e({type:"MultiPolygon",coordinates:t},n,r)}function l(e,n){void 0===n&&(n="kilometers");var r=t.factors[n];if(!r)throw new Error(n+" units is invalid");return e*r}function c(e,n){void 0===n&&(n="kilometers");var r=t.factors[n];if(!r)throw new Error(n+" units is invalid");return e/r}function f(t){return 180*(t%(2*Math.PI))/Math.PI}function h(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.earthRadius=6371008.8,t.factors={centimeters:100*t.earthRadius,centimetres:100*t.earthRadius,degrees:t.earthRadius/111325,feet:3.28084*t.earthRadius,inches:39.37*t.earthRadius,kilometers:t.earthRadius/1e3,kilometres:t.earthRadius/1e3,meters:t.earthRadius,metres:t.earthRadius,miles:t.earthRadius/1609.344,millimeters:1e3*t.earthRadius,millimetres:1e3*t.earthRadius,nauticalmiles:t.earthRadius/1852,radians:1,yards:1.0936*t.earthRadius},t.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/t.earthRadius,yards:1.0936133},t.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},t.feature=e,t.geometry=function(t,e,i){switch(t){case"Point":return n(e).geometry;case"LineString":return o(e).geometry;case"Polygon":return r(e).geometry;case"MultiPoint":return a(e).geometry;case"MultiLineString":return s(e).geometry;case"MultiPolygon":return u(e).geometry;default:throw new Error(t+" is invalid")}},t.point=n,t.points=function(t,e,r){return void 0===r&&(r={}),i(t.map((function(t){return n(t,e)})),r)},t.polygon=r,t.polygons=function(t,e,n){return void 0===n&&(n={}),i(t.map((function(t){return r(t,e)})),n)},t.lineString=o,t.lineStrings=function(t,e,n){return void 0===n&&(n={}),i(t.map((function(t){return o(t,e)})),n)},t.featureCollection=i,t.multiLineString=s,t.multiPoint=a,t.multiPolygon=u,t.geometryCollection=function(t,n,r){return void 0===r&&(r={}),e({type:"GeometryCollection",geometries:t},n,r)},t.round=function(t,e){if(void 0===e&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,e||0);return Math.round(t*n)/n},t.radiansToLength=l,t.lengthToRadians=c,t.lengthToDegrees=function(t,e){return f(c(t,e))},t.bearingToAzimuth=function(t){var e=t%360;return e<0&&(e+=360),e},t.radiansToDegrees=f,t.degreesToRadians=function(t){return t%360*Math.PI/180},t.convertLength=function(t,e,n){if(void 0===e&&(e="kilometers"),void 0===n&&(n="kilometers"),!(t>=0))throw new Error("length must be a positive number");return l(c(t,e),n)},t.convertArea=function(e,n,r){if(void 0===n&&(n="meters"),void 0===r&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var o=t.areaFactors[n];if(!o)throw new Error("invalid original units");var i=t.areaFactors[r];if(!i)throw new Error("invalid final units");return e/o*i},t.isNumber=h,t.isObject=function(t){return!!t&&t.constructor===Object},t.validateBBox=function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!h(t))throw new Error("bbox must only contain numbers")}))},t.validateId=function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}}(Mt);var It={};Object.defineProperty(It,"__esModule",{value:!0});var Ot=Mt;function Tt(t,e,n){if(null!==t)for(var r,o,i,s,a,u,l,c,f=0,h=0,p=t.type,d="FeatureCollection"===p,g="Feature"===p,y=d?t.features.length:1,v=0;v<y;v++){a=(c=!!(l=d?t.features[v].geometry:g?t.geometry:t)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var m=0;m<a;m++){var b=0,E=0;if(null!==(s=c?l.geometries[m]:l)){u=s.coordinates;var _=s.type;switch(f=!n||"Polygon"!==_&&"MultiPolygon"!==_?0:1,_){case null:break;case"Point":if(!1===e(u,h,v,b,E))return!1;h++,b++;break;case"LineString":case"MultiPoint":for(r=0;r<u.length;r++){if(!1===e(u[r],h,v,b,E))return!1;h++,"MultiPoint"===_&&b++}"LineString"===_&&b++;break;case"Polygon":case"MultiLineString":for(r=0;r<u.length;r++){for(o=0;o<u[r].length-f;o++){if(!1===e(u[r][o],h,v,b,E))return!1;h++}"MultiLineString"===_&&b++,"Polygon"===_&&E++}"Polygon"===_&&b++;break;case"MultiPolygon":for(r=0;r<u.length;r++){for(E=0,o=0;o<u[r].length;o++){for(i=0;i<u[r][o].length-f;i++){if(!1===e(u[r][o][i],h,v,b,E))return!1;h++}E++}b++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(!1===Tt(s.geometries[r],e,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Lt(t,e){var n;switch(t.type){case"FeatureCollection":for(n=0;n<t.features.length&&!1!==e(t.features[n].properties,n);n++);break;case"Feature":e(t.properties,0)}}function Ft(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var n=0;n<t.features.length&&!1!==e(t.features[n],n);n++);}function kt(t,e){var n,r,o,i,s,a,u,l,c,f,h=0,p="FeatureCollection"===t.type,d="Feature"===t.type,g=p?t.features.length:1;for(n=0;n<g;n++){for(a=p?t.features[n].geometry:d?t.geometry:t,l=p?t.features[n].properties:d?t.properties:{},c=p?t.features[n].bbox:d?t.bbox:void 0,f=p?t.features[n].id:d?t.id:void 0,s=(u=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,o=0;o<s;o++)if(null!==(i=u?a.geometries[o]:a))switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(i,h,l,c,f))return!1;break;case"GeometryCollection":for(r=0;r<i.geometries.length;r++)if(!1===e(i.geometries[r],h,l,c,f))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,h,l,c,f))return!1;h++}}function Nt(t,e){kt(t,(function(t,n,r,o,i){var s,a=null===t?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1!==e(Ot.feature(t,r,{bbox:o,id:i}),n,0)&&void 0}switch(a){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var u=0;u<t.coordinates.length;u++){var l={type:s,coordinates:t.coordinates[u]};if(!1===e(Ot.feature(l,r),n,u))return!1}}))}function At(t,e){Nt(t,(function(t,n,r){var o=0;if(t.geometry){var i=t.geometry.type;if("Point"!==i&&"MultiPoint"!==i){var s,a=0,u=0,l=0;return!1!==Tt(t,(function(i,c,f,h,p){if(void 0===s||n>a||h>u||p>l)return s=i,a=n,u=h,l=p,void(o=0);var d=Ot.lineString([s,i],t.properties);if(!1===e(d,n,r,p,o))return!1;o++,s=i}))&&void 0}}}))}function Rt(t,e){if(!t)throw new Error("geojson is required");Nt(t,(function(t,n,r){if(null!==t.geometry){var o=t.geometry.type,i=t.geometry.coordinates;switch(o){case"LineString":if(!1===e(t,n,r,0,0))return!1;break;case"Polygon":for(var s=0;s<i.length;s++)if(!1===e(Ot.lineString(i[s],t.properties),n,r,s))return!1}}}))}It.coordAll=function(t){var e=[];return Tt(t,(function(t){e.push(t)})),e},It.coordEach=Tt,It.coordReduce=function(t,e,n,r){var o=n;return Tt(t,(function(t,r,i,s,a){o=0===r&&void 0===n?t:e(o,t,r,i,s,a)}),r),o},It.featureEach=Ft,It.featureReduce=function(t,e,n){var r=n;return Ft(t,(function(t,o){r=0===o&&void 0===n?t:e(r,t,o)})),r},It.findPoint=function(t,e){if(e=e||{},!Ot.isObject(e))throw new Error("options is invalid");var n,r=e.featureIndex||0,o=e.multiFeatureIndex||0,i=e.geometryIndex||0,s=e.coordIndex||0,a=e.properties;switch(t.type){case"FeatureCollection":r<0&&(r=t.features.length+r),a=a||t.features[r].properties,n=t.features[r].geometry;break;case"Feature":a=a||t.properties,n=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=t;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var u=n.coordinates;switch(n.type){case"Point":return Ot.point(u,a,e);case"MultiPoint":return o<0&&(o=u.length+o),Ot.point(u[o],a,e);case"LineString":return s<0&&(s=u.length+s),Ot.point(u[s],a,e);case"Polygon":return i<0&&(i=u.length+i),s<0&&(s=u[i].length+s),Ot.point(u[i][s],a,e);case"MultiLineString":return o<0&&(o=u.length+o),s<0&&(s=u[o].length+s),Ot.point(u[o][s],a,e);case"MultiPolygon":return o<0&&(o=u.length+o),i<0&&(i=u[o].length+i),s<0&&(s=u[o][i].length-s),Ot.point(u[o][i][s],a,e)}throw new Error("geojson is invalid")},It.findSegment=function(t,e){if(e=e||{},!Ot.isObject(e))throw new Error("options is invalid");var n,r=e.featureIndex||0,o=e.multiFeatureIndex||0,i=e.geometryIndex||0,s=e.segmentIndex||0,a=e.properties;switch(t.type){case"FeatureCollection":r<0&&(r=t.features.length+r),a=a||t.features[r].properties,n=t.features[r].geometry;break;case"Feature":a=a||t.properties,n=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=t;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var u=n.coordinates;switch(n.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=u.length+s-1),Ot.lineString([u[s],u[s+1]],a,e);case"Polygon":return i<0&&(i=u.length+i),s<0&&(s=u[i].length+s-1),Ot.lineString([u[i][s],u[i][s+1]],a,e);case"MultiLineString":return o<0&&(o=u.length+o),s<0&&(s=u[o].length+s-1),Ot.lineString([u[o][s],u[o][s+1]],a,e);case"MultiPolygon":return o<0&&(o=u.length+o),i<0&&(i=u[o].length+i),s<0&&(s=u[o][i].length-s-1),Ot.lineString([u[o][i][s],u[o][i][s+1]],a,e)}throw new Error("geojson is invalid")},It.flattenEach=Nt,It.flattenReduce=function(t,e,n){var r=n;return Nt(t,(function(t,o,i){r=0===o&&0===i&&void 0===n?t:e(r,t,o,i)})),r},It.geomEach=kt,It.geomReduce=function(t,e,n){var r=n;return kt(t,(function(t,o,i,s,a){r=0===o&&void 0===n?t:e(r,t,o,i,s,a)})),r},It.lineEach=Rt,It.lineReduce=function(t,e,n){var r=n;return Rt(t,(function(t,o,i,s){r=0===o&&void 0===n?t:e(r,t,o,i,s)})),r},It.propEach=Lt,It.propReduce=function(t,e,n){var r=n;return Lt(t,(function(t,o){r=0===o&&void 0===n?t:e(r,t,o)})),r},It.segmentEach=At,It.segmentReduce=function(t,e,n){var r=n,o=!1;return At(t,(function(t,i,s,a,u){r=!1===o&&void 0===n?t:e(r,t,i,s,a,u),o=!0})),r};var Dt={};Object.defineProperty(Dt,"__esModule",{value:!0});var Ut=It;function jt(t){var e=[1/0,1/0,-1/0,-1/0];return Ut.coordEach(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}jt.default=jt,Dt.default=jt;var Bt=Ct,Gt=Mt,Vt=It,Yt=Dt.default,Xt=Vt.featureEach;Vt.coordEach;var zt=Gt.featureCollection;function qt(t){var e=new Bt(t);return e.insert=function(t){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Yt(t),Bt.prototype.insert.call(this,t)},e.load=function(t){var e=[];return Array.isArray(t)?t.forEach((function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:Yt(t),e.push(t)})):Xt(t,(function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:Yt(t),e.push(t)})),Bt.prototype.load.call(this,e)},e.remove=function(t,e){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Yt(t),Bt.prototype.remove.call(this,t,e)},e.clear=function(){return Bt.prototype.clear.call(this)},e.search=function(t){var e=Bt.prototype.search.call(this,this.toBBox(t));return zt(e)},e.collides=function(t){return Bt.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Bt.prototype.all.call(this);return zt(t)},e.toJSON=function(){return Bt.prototype.toJSON.call(this)},e.fromJSON=function(t){return Bt.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var e;if(t.bbox)e=t.bbox;else if(Array.isArray(t)&&4===t.length)e=t;else if(Array.isArray(t)&&6===t.length)e=[t[0],t[1],t[3],t[4]];else if("Feature"===t.type)e=Yt(t);else{if("FeatureCollection"!==t.type)throw new Error("invalid geojson");e=Yt(t)}return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},e}function Jt(t,e){var n={},r=[];if("LineString"===t.type&&(t=u(t)),"LineString"===e.type&&(e=u(e)),"Feature"===t.type&&"Feature"===e.type&&null!==t.geometry&&null!==e.geometry&&"LineString"===t.geometry.type&&"LineString"===e.geometry.type&&2===t.geometry.coordinates.length&&2===e.geometry.coordinates.length){var o=$t(t,e);return o&&r.push(o),f(r)}var i=at.exports();return i.load(st(e)),_(st(t),(function(t){_(i.search(t),(function(e){var o=$t(t,e);if(o){var i=v(o).join(",");n[i]||(n[i]=!0,r.push(o))}}))})),f(r)}function $t(t,e){var n=v(t),r=v(e);if(2!==n.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==r.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=n[0][0],i=n[0][1],s=n[1][0],a=n[1][1],l=r[0][0],c=r[0][1],f=r[1][0],h=r[1][1],p=(h-c)*(s-o)-(f-l)*(a-i),d=(f-l)*(i-c)-(h-c)*(o-l),y=(s-o)*(i-c)-(a-i)*(o-l);if(0===p)return null;var m=d/p,b=y/p;return m>=0&&m<=1&&b>=0&&b<=1?function(t,e,n){if(void 0===n&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!g(t[0])||!g(t[1]))throw new Error("coordinates must contain numbers");return u({type:"Point",coordinates:t},e,n)}([o+m*(s-o),i+m*(a-i)]):null}function Wt(t,e,n){if(void 0===n&&(n={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var r=function(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}(t),o=m(e),i=o.type,s=e.bbox,a=o.coordinates;if(s&&!1===function(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}(r,s))return!1;"Polygon"===i&&(a=[a]);for(var u=!1,l=0;l<a.length&&!u;l++)if(Ht(r,a[l][0],n.ignoreBoundary)){for(var c=!1,f=1;f<a[l].length&&!c;)Ht(r,a[l][f],!n.ignoreBoundary)&&(c=!0),f++;c||(u=!0)}return u}function Ht(t,e,n){var r=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var o=0,i=e.length-1;o<e.length;i=o++){var s=e[o][0],a=e[o][1],u=e[i][0],l=e[i][1];if(t[1]*(s-u)+a*(u-t[0])+l*(t[0]-s)==0&&(s-t[0])*(u-t[0])<=0&&(a-t[1])*(l-t[1])<=0)return!n;a>t[1]!=l>t[1]&&t[0]<(u-s)*(t[1]-a)/(l-a)+s&&(r=!r)}return r}function Zt(t,e){void 0===e&&(e={});var n=m(t);switch(e.properties||"Feature"!==t.type||(e.properties=t.properties),n.type){case"Polygon":return function(t,e){void 0===e&&(e={});var n=m(t).coordinates,r=e.properties?e.properties:"Feature"===t.type?t.properties:{};return Kt(n,r)}(n,e);case"MultiPolygon":return function(t,e){void 0===e&&(e={});var n=m(t).coordinates,r=e.properties?e.properties:"Feature"===t.type?t.properties:{},o=[];return n.forEach((function(t){o.push(Kt(t,r))})),f(o)}(n,e);default:throw new Error("invalid poly")}}function Kt(t,e){return t.length>1?h(t,e):c(t[0],e)}function Qt(t,e){var n=!0;return S(t,(function(t){S(e,(function(e){if(!1===n)return!1;n=function(t,e){switch(t.type){case"Point":switch(e.type){case"Point":return n=t.coordinates,r=e.coordinates,!(n[0]===r[0]&&n[1]===r[1]);case"LineString":return!te(e,t);case"Polygon":return!Wt(t,e)}break;case"LineString":switch(e.type){case"Point":return!te(t,e);case"LineString":return!function(t,e){if(Jt(t,e).features.length>0)return!0;return!1}(t,e);case"Polygon":return!ee(e,t)}break;case"Polygon":switch(e.type){case"Point":return!Wt(e,t);case"LineString":return!ee(t,e);case"Polygon":return!function(t,e){for(var n=0,r=t.coordinates[0];n<r.length;n++){if(Wt(r[n],e))return!0}for(var o=0,i=e.coordinates[0];o<i.length;o++){if(Wt(i[o],t))return!0}if(Jt(Zt(t),Zt(e)).features.length>0)return!0;return!1}(e,t)}}var n,r;return!1}(t.geometry,e.geometry)}))})),n}function te(t,e){for(var n=0;n<t.coordinates.length-1;n++)if(ne(t.coordinates[n],t.coordinates[n+1],e.coordinates))return!0;return!1}function ee(t,e){for(var n=0,r=e.coordinates;n<r.length;n++){if(Wt(r[n],t))return!0}return Jt(e,Zt(t)).features.length>0}function ne(t,e,n){var r=n[0]-t[0],o=n[1]-t[1],i=e[0]-t[0],s=e[1]-t[1];return 0==r*s-o*i&&(Math.abs(i)>=Math.abs(s)?i>0?t[0]<=n[0]&&n[0]<=e[0]:e[0]<=n[0]&&n[0]<=t[0]:s>0?t[1]<=n[1]&&n[1]<=e[1]:e[1]<=n[1]&&n[1]<=t[1])}function re(t){var e=t[0],n=t[1];return[n[0]-e[0],n[1]-e[1]]}function oe(t,e){return t[0]*e[1]-e[0]*t[1]}function ie(t,e){return!function(t,e){return 0===oe(re(t),re(e))}(t,e)&&function(t,e){var n,r,o=t[0],i=re(t),s=e[0],a=re(e),u=oe(i,a),l=function(t,e){return[t[0]+e[0],t[1]+e[1]]}(o,function(t,e){return[t*e[0],t*e[1]]}(oe((r=o,[(n=s)[0]-r[0],n[1]-r[1]]),a)/u,i));return l}(t,e)}function se(t,e,n){if(!y(n=n||{}))throw new Error("options is invalid");var r=n.units;if(!t)throw new Error("geojson is required");if(null==e||isNaN(e))throw new Error("distance is required");var o=function(t,e){return"FeatureCollection"===t.type?"FeatureCollection":"GeometryCollection"===t.type?"GeometryCollection":"Feature"===t.type&&null!==t.geometry?t.geometry.type:t.type}(t),i=t.properties;switch(o){case"LineString":return ae(t,e,r);case"MultiLineString":var s=[];return S(t,(function(t){s.push(ae(t,e,r).geometry.coordinates)})),h(s,i);default:throw new Error("geometry "+o+" is not supported")}}function ae(t,e,n){var r=[],o=d(e,n),i=v(t),s=[];return i.forEach((function(t,e){if(e!==i.length-1){var n=(l=t,c=i[e+1],f=o,h=Math.sqrt((l[0]-c[0])*(l[0]-c[0])+(l[1]-c[1])*(l[1]-c[1])),p=l[0]+f*(c[1]-l[1])/h,d=c[0]+f*(c[1]-l[1])/h,g=l[1]+f*(l[0]-c[0])/h,y=c[1]+f*(l[0]-c[0])/h,[[p,g],[d,y]]);if(r.push(n),e>0){var a=r[e-1],u=ie(n,a);!1!==u&&(a[1]=u,n[0]=u),s.push(a[0]),e===i.length-2&&(s.push(n[0]),s.push(n[1]))}2===i.length&&(s.push(n[0]),s.push(n[1]))}var l,c,f,h,p,d,g,y})),c(s,t.properties)}function ue(t){var e=[1/0,1/0,-1/0,-1/0];return E(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}function le(t,n){var r,o,i;void 0===n&&(n={});var s=n.properties,a=null===(r=n.autoComplete)||void 0===r||r,u=null===(o=n.orderCoords)||void 0===o||o;if(null!==(i=n.mutate)&&void 0!==i&&i||(t=e(t)),"FeatureCollection"===t.type){var l=[];return t.features.forEach((function(t){l.push(v(ce(t,{},a,u)))})),p(l,s)}return ce(t,s,a,u)}function ce(t,e,n,r){e=e||("Feature"===t.type?t.properties:{});var o=m(t),i=o.coordinates,s=o.type;if(!i.length)throw new Error("line must contain coordinates");switch(s){case"LineString":return n&&(i=fe(i)),l([i],e);case"MultiLineString":var a=[],u=0;return i.forEach((function(t){if(n&&(t=fe(t)),r){var e=function(t){var e=t[0],n=t[1],r=t[2],o=t[3];return Math.abs(e-r)*Math.abs(n-o)}
/**
     * splaytree v3.1.1
     * Fast Splay tree for Node and browser
     *
     * @author Alexander Milevski <info@w8r.name>
     * @license MIT
     * @preserve
     */
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */(ue(c(t)));e>u?(a.unshift(t),u=e):a.push(t)}else a.push(t)})),l(a,e);default:throw new Error("geometry type "+s+" is not supported")}}function fe(t){var e=t[0],n=e[0],r=e[1],o=t[t.length-1],i=o[0],s=o[1];return n===i&&r===s||t.push(e),t}function he(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}at.exports=qt,at.exports.default=qt,ue.default=ue;var pe=function(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null};function de(t,e){return t>e?1:t<e?-1:0}function ge(t,e,n){for(var r=new pe(null,null),o=r,i=r;;){var s=n(t,e.key);if(s<0){if(null===e.left)break;if(n(t,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,null===(e=a).left)break}i.left=e,i=e,e=e.left}else{if(!(s>0))break;if(null===e.right)break;if(n(t,e.right.key)>0){a=e.right;if(e.right=a.left,a.left=e,null===(e=a).right)break}o.right=e,o=e,e=e.right}}return o.right=e.left,i.left=e.right,e.left=r.right,e.right=r.left,e}function ye(t,e,n,r){var o=new pe(t,e);if(null===n)return o.left=o.right=null,o;var i=r(t,(n=ge(t,n,r)).key);return i<0?(o.left=n.left,o.right=n,n.left=null):i>=0&&(o.right=n.right,o.left=n,n.right=null),o}function ve(t,e,n){var r=null,o=null;if(e){var i=n((e=ge(t,e,n)).key,t);0===i?(r=e.left,o=e.right):i<0?(o=e.right,e.right=null,r=e):(r=e.left,e.left=null,o=e)}return{left:r,right:o}}function me(t,e,n,r,o){if(t){r(e+(n?"└── ":"├── ")+o(t)+"\n");var i=e+(n?"    ":"│   ");t.left&&me(t.left,i,!1,r,o),t.right&&me(t.right,i,!0,r,o)}}var be=function(){function t(t){void 0===t&&(t=de),this._root=null,this._size=0,this._comparator=t}return t.prototype.insert=function(t,e){return this._size++,this._root=ye(t,e,this._root,this._comparator)},t.prototype.add=function(t,e){var n=new pe(t,e);null===this._root&&(n.left=n.right=null,this._size++,this._root=n);var r=this._comparator,o=ge(t,this._root,r),i=r(t,o.key);return 0===i?this._root=o:(i<0?(n.left=o.left,n.right=o,o.left=null):i>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},t.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},t.prototype._remove=function(t,e,n){var r;return null===e?null:0===n(t,(e=ge(t,e,n)).key)?(null===e.left?r=e.right:(r=ge(t,e.left,n)).right=e.right,this._size--,r):e},t.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=ge(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},t.prototype.findStatic=function(t){for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(0===r)return e;e=r<0?e.left:e.right}return null},t.prototype.find=function(t){return this._root&&(this._root=ge(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root},t.prototype.contains=function(t){for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(0===r)return!0;e=r<0?e.left:e.right}return!1},t.prototype.forEach=function(t,e){for(var n=this._root,r=[],o=!1;!o;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),t.call(e,n),n=n.right):o=!0;return this},t.prototype.range=function(t,e,n,r){for(var o=[],i=this._comparator,s=this._root;0!==o.length||s;)if(s)o.push(s),s=s.left;else{if(i((s=o.pop()).key,e)>0)break;if(i(s.key,t)>=0&&n.call(r,s))return this;s=s.right}return this},t.prototype.keys=function(){var t=[];return this.forEach((function(e){var n=e.key;return t.push(n)})),t},t.prototype.values=function(){var t=[];return this.forEach((function(e){var n=e.data;return t.push(n)})),t},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.left;)t=t.left;return t},t.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.right;)t=t.right;return t},t.prototype.at=function(t){for(var e=this._root,n=!1,r=0,o=[];!n;)if(e)o.push(e),e=e.left;else if(o.length>0){if(e=o.pop(),r===t)return e;r++,e=e.right}else n=!0;return null},t.prototype.next=function(t){var e=this._root,n=null;if(t.right){for(n=t.right;n.left;)n=n.left;return n}for(var r=this._comparator;e;){var o=r(t.key,e.key);if(0===o)break;o<0?(n=e,e=e.left):e=e.right}return n},t.prototype.prev=function(t){var e=this._root,n=null;if(null!==t.left){for(n=t.left;n.right;)n=n.right;return n}for(var r=this._comparator;e;){var o=r(t.key,e.key);if(0===o)break;o<0?e=e.left:(n=e,e=e.right)}return n},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return function(t){var e=t,n=[],r=!1,o=new pe(null,null),i=o;for(;!r;)e?(n.push(e),e=e.left):n.length>0?e=(e=i=i.next=n.pop()).right:r=!0;return i.next=null,o.next}(this._root)},t.prototype.load=function(t,e,n){void 0===e&&(e=[]),void 0===n&&(n=!1);var r=t.length,o=this._comparator;if(n&&xe(t,e,0,r-1,o),null===this._root)this._root=Ee(t,e,0,r),this._size=r;else{var i=function(t,e,n){var r=new pe(null,null),o=r,i=t,s=e;for(;null!==i&&null!==s;)n(i.key,s.key)<0?(o.next=i,i=i.next):(o.next=s,s=s.next),o=o.next;null!==i?o.next=i:null!==s&&(o.next=s);return r.next}(this.toList(),function(t,e){for(var n=new pe(null,null),r=n,o=0;o<t.length;o++)r=r.next=new pe(t[o],e[o]);return r.next=null,n.next}(t,e),o);r=this._size+r,this._root=_e({head:i},0,r)}return this},t.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){void 0===t&&(t=function(t){return String(t.key)});var e=[];return me(this._root,"",!0,(function(t){return e.push(t)}),t),e.join("")},t.prototype.update=function(t,e,n){var r=this._comparator,o=ve(t,this._root,r),i=o.left,s=o.right;r(t,e)<0?s=ye(e,n,s,r):i=ye(e,n,i,r),this._root=function(t,e,n){return null===e?t:(null===t||((e=ge(t.key,e,n)).left=t),e)}(i,s,r)},t.prototype.split=function(t){return ve(t,this._root,this._comparator)},t.prototype[Symbol.iterator]=function(){var t;return he(this,(function(e){switch(e.label){case 0:t=this.minNode(),e.label=1;case 1:return t?[4,t]:[3,3];case 2:return e.sent(),t=this.next(t),[3,1];case 3:return[2]}}))},t}();function Ee(t,e,n,r){var o=r-n;if(o>0){var i=n+Math.floor(o/2),s=t[i],a=e[i],u=new pe(s,a);return u.left=Ee(t,e,n,i),u.right=Ee(t,e,i+1,r),u}return null}function _e(t,e,n){var r=n-e;if(r>0){var o=e+Math.floor(r/2),i=_e(t,e,o),s=t.head;return s.left=i,t.head=t.head.next,s.right=_e(t,o+1,n),s}return null}function xe(t,e,n,r,o){if(!(n>=r)){for(var i=t[n+r>>1],s=n-1,a=r+1;;){do{s++}while(o(t[s],i)<0);do{a--}while(o(t[a],i)>0);if(s>=a)break;var u=t[s];t[s]=t[a],t[a]=u,u=e[s],e[s]=e[a],e[a]=u}xe(t,e,n,a,o),xe(t,e,a+1,r,o)}}function Se(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function we(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Pe(t,e,n){return e&&we(t.prototype,e),n&&we(t,n),t}var Ce=function(t,e){return t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y},Me=function(t,e){if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;var n=t.ll.x<e.ll.x?e.ll.x:t.ll.x,r=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:n,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:r,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}},Ie=Number.EPSILON;void 0===Ie&&(Ie=Math.pow(2,-52));var Oe=Ie*Ie,Te=function(t,e){if(-Ie<t&&t<Ie&&-Ie<e&&e<Ie)return 0;var n=t-e;return n*n<Oe*t*e?0:t<e?-1:1},Le=function(){function t(){Se(this,t),this.reset()}return Pe(t,[{key:"reset",value:function(){this.xRounder=new Fe,this.yRounder=new Fe}},{key:"round",value:function(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}]),t}(),Fe=function(){function t(){Se(this,t),this.tree=new be,this.round(0)}return Pe(t,[{key:"round",value:function(t){var e=this.tree.add(t),n=this.tree.prev(e);if(null!==n&&0===Te(e.key,n.key))return this.tree.remove(t),n.key;var r=this.tree.next(e);return null!==r&&0===Te(e.key,r.key)?(this.tree.remove(t),r.key):t}}]),t}(),ke=new Le,Ne=function(t,e){return t.x*e.y-t.y*e.x},Ae=function(t,e){return t.x*e.x+t.y*e.y},Re=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},o={x:n.x-t.x,y:n.y-t.y},i=Ne(r,o);return Te(i,0)},De=function(t){return Math.sqrt(Ae(t,t))},Ue=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},o={x:n.x-t.x,y:n.y-t.y};return Ae(o,r)/De(o)/De(r)},je=function(t,e,n){return 0===e.y?null:{x:t.x+e.x/e.y*(n-t.y),y:n}},Be=function(t,e,n){return 0===e.x?null:{x:n,y:t.y+e.y/e.x*(n-t.x)}},Ge=function(){function t(e,n){Se(this,t),void 0===e.events?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=n}return Pe(t,null,[{key:"compare",value:function(e,n){var r=t.comparePoints(e.point,n.point);return 0!==r?r:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:Ye.compare(e.segment,n.segment))}},{key:"comparePoints",value:function(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}}]),Pe(t,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var e=t.point.events,n=0,r=e.length;n<r;n++){var o=e[n];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,e=0;e<t;e++){var n=this.point.events[e];if(void 0===n.segment.consumedBy)for(var r=e+1;r<t;r++){var o=this.point.events[r];void 0===o.consumedBy&&(n.otherSE.point.events===o.otherSE.point.events&&n.segment.consume(o.segment))}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],e=0,n=this.point.events.length;e<n;e++){var r=this.point.events[e];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&t.push(r)}return t}},{key:"getLeftmostComparator",value:function(t){var e=this,n=new Map,r=function(r){var o,i,s,a,u,l=r.otherSE;n.set(r,{sine:(o=e.point,i=t.point,s=l.point,a={x:i.x-o.x,y:i.y-o.y},u={x:s.x-o.x,y:s.y-o.y},Ne(u,a)/De(u)/De(a)),cosine:Ue(e.point,t.point,l.point)})};return function(t,e){n.has(t)||r(t),n.has(e)||r(e);var o=n.get(t),i=o.sine,s=o.cosine,a=n.get(e),u=a.sine,l=a.cosine;return i>=0&&u>=0?s<l?1:s>l?-1:0:i<0&&u<0?s<l?-1:s>l?1:0:u<i?-1:u>i?1:0}}}]),t}(),Ve=0,Ye=function(){function t(e,n,r,o){Se(this,t),this.id=++Ve,this.leftSE=e,e.segment=this,e.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=e,this.rings=r,this.windings=o}return Pe(t,null,[{key:"compare",value:function(t,e){var n=t.leftSE.point.x,r=e.leftSE.point.x,o=t.rightSE.point.x,i=e.rightSE.point.x;if(i<n)return 1;if(o<r)return-1;var s=t.leftSE.point.y,a=e.leftSE.point.y,u=t.rightSE.point.y,l=e.rightSE.point.y;if(n<r){if(a<s&&a<u)return 1;if(a>s&&a>u)return-1;var c=t.comparePoint(e.leftSE.point);if(c<0)return 1;if(c>0)return-1;var f=e.comparePoint(t.rightSE.point);return 0!==f?f:-1}if(n>r){if(s<a&&s<l)return-1;if(s>a&&s>l)return 1;var h=e.comparePoint(t.leftSE.point);if(0!==h)return h;var p=t.comparePoint(e.rightSE.point);return p<0?1:p>0?-1:1}if(s<a)return-1;if(s>a)return 1;if(o<i){var d=e.comparePoint(t.rightSE.point);if(0!==d)return d}if(o>i){var g=t.comparePoint(e.rightSE.point);if(g<0)return 1;if(g>0)return-1}if(o!==i){var y=u-s,v=o-n,m=l-a,b=i-r;if(y>v&&m<b)return 1;if(y<v&&m>b)return-1}return o>i?1:o<i||u<l?-1:u>l?1:t.id<e.id?-1:t.id>e.id?1:0}}]),Pe(t,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var e=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(e.x===n.x)return t.x===e.x?0:t.x<e.x?1:-1;var o=(t.y-e.y)/r.y,i=e.x+o*r.x;if(t.x===i)return 0;var s=(t.x-e.x)/r.x,a=e.y+s*r.y;return t.y===a?0:t.y<a?-1:1}},{key:"getIntersection",value:function(t){var e=this.bbox(),n=t.bbox(),r=Me(e,n);if(null===r)return null;var o=this.leftSE.point,i=this.rightSE.point,s=t.leftSE.point,a=t.rightSE.point,u=Ce(e,s)&&0===this.comparePoint(s),l=Ce(n,o)&&0===t.comparePoint(o),c=Ce(e,a)&&0===this.comparePoint(a),f=Ce(n,i)&&0===t.comparePoint(i);if(l&&u)return f&&!c?i:!f&&c?a:null;if(l)return c&&o.x===a.x&&o.y===a.y?null:o;if(u)return f&&i.x===s.x&&i.y===s.y?null:s;if(f&&c)return null;if(f)return i;if(c)return a;var h=function(t,e,n,r){if(0===e.x)return Be(n,r,t.x);if(0===r.x)return Be(t,e,n.x);if(0===e.y)return je(n,r,t.y);if(0===r.y)return je(t,e,n.y);var o=Ne(e,r);if(0==o)return null;var i={x:n.x-t.x,y:n.y-t.y},s=Ne(i,e)/o,a=Ne(i,r)/o;return{x:(t.x+a*e.x+(n.x+s*r.x))/2,y:(t.y+a*e.y+(n.y+s*r.y))/2}}(o,this.vector(),s,t.vector());return null===h?null:Ce(r,h)?ke.round(h.x,h.y):null}},{key:"split",value:function(e){var n=[],r=void 0!==e.events,o=new Ge(e,!0),i=new Ge(e,!1),s=this.rightSE;this.replaceRightSE(i),n.push(i),n.push(o);var a=new t(o,s,this.rings.slice(),this.windings.slice());return Ge.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Ge.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(o.checkForConsuming(),i.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var e=0,n=this.windings.length;e<n;e++)this.windings[e]*=-1}},{key:"consume",value:function(e){for(var n=this,r=e;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var o=t.compare(n,r);if(0!==o){if(o>0){var i=n;n=r,r=i}if(n.prev===r){var s=n;n=r,r=s}for(var a=0,u=r.rings.length;a<u;a++){var l=r.rings[a],c=r.windings[a],f=n.rings.indexOf(l);-1===f?(n.rings.push(l),n.windings.push(c)):n.windings[f]+=c}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var e=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys,o=0,i=this.rings.length;o<i;o++){var s=this.rings[o],a=this.windings[o],u=e.indexOf(s);-1===u?(e.push(s),n.push(a)):n[u]+=a}for(var l=[],c=[],f=0,h=e.length;f<h;f++)if(0!==n[f]){var p=e[f],d=p.poly;if(-1===c.indexOf(d))if(p.isExterior)l.push(d);else{-1===c.indexOf(d)&&c.push(d);var g=l.indexOf(p.poly);-1!==g&&l.splice(g,1)}}for(var y=0,v=l.length;y<v;y++){var m=l[y].multiPoly;-1===r.indexOf(m)&&r.push(m)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(Qe.type){case"union":var n=0===t.length,r=0===e.length;this._isInResult=n!==r;break;case"intersection":var o,i;t.length<e.length?(o=t.length,i=e.length):(o=e.length,i=t.length),this._isInResult=i===Qe.numMultiPolys&&o<i;break;case"xor":var s=Math.abs(t.length-e.length);this._isInResult=s%2==1;break;case"difference":var a=function(t){return 1===t.length&&t[0].isSubject};this._isInResult=a(t)!==a(e);break;default:throw new Error("Unrecognized operation type found ".concat(Qe.type))}return this._isInResult}}],[{key:"fromRing",value:function(e,n,r){var o,i,s,a=Ge.comparePoints(e,n);if(a<0)o=e,i=n,s=1;else{if(!(a>0))throw new Error("Tried to create degenerate segment at [".concat(e.x,", ").concat(e.y,"]"));o=n,i=e,s=-1}return new t(new Ge(o,!0),new Ge(i,!1),[r],[s])}}]),t}(),Xe=function(){function t(e,n,r){if(Se(this,t),!Array.isArray(e)||0===e.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=r,this.segments=[],"number"!=typeof e[0][0]||"number"!=typeof e[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var o=ke.round(e[0][0],e[0][1]);this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};for(var i=o,s=1,a=e.length;s<a;s++){if("number"!=typeof e[s][0]||"number"!=typeof e[s][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var u=ke.round(e[s][0],e[s][1]);u.x===i.x&&u.y===i.y||(this.segments.push(Ye.fromRing(i,u,this)),u.x<this.bbox.ll.x&&(this.bbox.ll.x=u.x),u.y<this.bbox.ll.y&&(this.bbox.ll.y=u.y),u.x>this.bbox.ur.x&&(this.bbox.ur.x=u.x),u.y>this.bbox.ur.y&&(this.bbox.ur.y=u.y),i=u)}o.x===i.x&&o.y===i.y||this.segments.push(Ye.fromRing(i,o,this))}return Pe(t,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.segments.length;e<n;e++){var r=this.segments[e];t.push(r.leftSE),t.push(r.rightSE)}return t}}]),t}(),ze=function(){function t(e,n){if(Se(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Xe(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,o=e.length;r<o;r++){var i=new Xe(e[r],this,!1);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i)}this.multiPoly=n}return Pe(t,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),e=0,n=this.interiorRings.length;e<n;e++)for(var r=this.interiorRings[e].getSweepEvents(),o=0,i=r.length;o<i;o++)t.push(r[o]);return t}}]),t}(),qe=function(){function t(e,n){if(Se(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof e[0][0][0]&&(e=[e])}catch(t){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,o=e.length;r<o;r++){var i=new ze(e[r],this);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i)}this.isSubject=n}return Pe(t,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++)for(var r=this.polys[e].getSweepEvents(),o=0,i=r.length;o<i;o++)t.push(r[o]);return t}}]),t}(),Je=function(){function t(e){Se(this,t),this.events=e;for(var n=0,r=e.length;n<r;n++)e[n].segment.ringOut=this;this.poly=null}return Pe(t,null,[{key:"factory",value:function(e){for(var n=[],r=0,o=e.length;r<o;r++){var i=e[r];if(i.isInResult()&&!i.ringOut){for(var s=null,a=i.leftSE,u=i.rightSE,l=[a],c=a.point,f=[];s=a,a=u,l.push(a),a.point!==c;)for(;;){var h=a.getAvailableLinkedEvents();if(0===h.length){var p=l[0].point,d=l[l.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(p.x,",")+" ".concat(p.y,"]. Last matching segment found ends at")+" [".concat(d.x,", ").concat(d.y,"]."))}if(1===h.length){u=h[0].otherSE;break}for(var g=null,y=0,v=f.length;y<v;y++)if(f[y].point===a.point){g=y;break}if(null===g){f.push({index:l.length,point:a.point});var m=a.getLeftmostComparator(s);u=h.sort(m)[0].otherSE;break}var b=f.splice(g)[0],E=l.splice(b.index);E.unshift(E[0].otherSE),n.push(new t(E.reverse()))}n.push(new t(l))}}return n}}]),Pe(t,[{key:"getGeom",value:function(){for(var t=this.events[0].point,e=[t],n=1,r=this.events.length-1;n<r;n++){var o=this.events[n].point,i=this.events[n+1].point;0!==Re(o,t,i)&&(e.push(o),t=o)}if(1===e.length)return null;var s=e[0],a=e[1];0===Re(s,t,a)&&e.shift(),e.push(e[0]);for(var u=this.isExteriorRing()?1:-1,l=this.isExteriorRing()?0:e.length-1,c=this.isExteriorRing()?e.length:-1,f=[],h=l;h!=c;h+=u)f.push([e[h].x,e[h].y]);return f}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],e=1,n=this.events.length;e<n;e++){var r=this.events[e];Ge.compare(t,r)>0&&(t=r)}for(var o=t.segment.prevInResult(),i=o?o.prevInResult():null;;){if(!o)return null;if(!i)return o.ringOut;if(i.ringOut!==o.ringOut)return i.ringOut.enclosingRing()!==o.ringOut?o.ringOut:o.ringOut.enclosingRing();o=i.prevInResult(),i=o?o.prevInResult():null}}}]),t}(),$e=function(){function t(e){Se(this,t),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Pe(t,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(var e=0,n=this.interiorRings.length;e<n;e++){var r=this.interiorRings[e].getGeom();null!==r&&t.push(r)}return t}}]),t}(),We=function(){function t(e){Se(this,t),this.rings=e,this.polys=this._composePolys(e)}return Pe(t,[{key:"getGeom",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++){var r=this.polys[e].getGeom();null!==r&&t.push(r)}return t}},{key:"_composePolys",value:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var o=t[n];if(!o.poly)if(o.isExteriorRing())e.push(new $e(o));else{var i=o.enclosingRing();i.poly||e.push(new $e(i)),i.poly.addInterior(o)}}return e}}]),t}(),He=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ye.compare;Se(this,t),this.queue=e,this.tree=new be(n),this.segments=[]}return Pe(t,[{key:"process",value:function(t){var e=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),n;var r=t.isLeft?this.tree.insert(e):this.tree.find(e);if(!r)throw new Error("Unable to find segment #".concat(e.id," ")+"[".concat(e.leftSE.point.x,", ").concat(e.leftSE.point.y,"] -> ")+"[".concat(e.rightSE.point.x,", ").concat(e.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var o=r,i=r,s=void 0,a=void 0;void 0===s;)null===(o=this.tree.prev(o))?s=null:void 0===o.key.consumedBy&&(s=o.key);for(;void 0===a;)null===(i=this.tree.next(i))?a=null:void 0===i.key.consumedBy&&(a=i.key);if(t.isLeft){var u=null;if(s){var l=s.getIntersection(e);if(null!==l&&(e.isAnEndpoint(l)||(u=l),!s.isAnEndpoint(l)))for(var c=this._splitSafely(s,l),f=0,h=c.length;f<h;f++)n.push(c[f])}var p=null;if(a){var d=a.getIntersection(e);if(null!==d&&(e.isAnEndpoint(d)||(p=d),!a.isAnEndpoint(d)))for(var g=this._splitSafely(a,d),y=0,v=g.length;y<v;y++)n.push(g[y])}if(null!==u||null!==p){var m=null;if(null===u)m=p;else if(null===p)m=u;else{m=Ge.comparePoints(u,p)<=0?u:p}this.queue.remove(e.rightSE),n.push(e.rightSE);for(var b=e.split(m),E=0,_=b.length;E<_;E++)n.push(b[E])}n.length>0?(this.tree.remove(e),n.push(t)):(this.segments.push(e),e.prev=s)}else{if(s&&a){var x=s.getIntersection(a);if(null!==x){if(!s.isAnEndpoint(x))for(var S=this._splitSafely(s,x),w=0,P=S.length;w<P;w++)n.push(S[w]);if(!a.isAnEndpoint(x))for(var C=this._splitSafely(a,x),M=0,I=C.length;M<I;M++)n.push(C[M])}}this.tree.remove(e)}return n}},{key:"_splitSafely",value:function(t,e){this.tree.remove(t);var n=t.rightSE;this.queue.remove(n);var r=t.split(e);return r.push(n),void 0===t.consumedBy&&this.tree.insert(t),r}}]),t}(),Ze="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Ke="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Qe=new(function(){function t(){Se(this,t)}return Pe(t,[{key:"run",value:function(t,e,n){Qe.type=t,ke.reset();for(var r=[new qe(e,!0)],o=0,i=n.length;o<i;o++)r.push(new qe(n[o],!1));if(Qe.numMultiPolys=r.length,"difference"===Qe.type)for(var s=r[0],a=1;a<r.length;)null!==Me(r[a].bbox,s.bbox)?a++:r.splice(a,1);if("intersection"===Qe.type)for(var u=0,l=r.length;u<l;u++)for(var c=r[u],f=u+1,h=r.length;f<h;f++)if(null===Me(c.bbox,r[f].bbox))return[];for(var p=new be(Ge.compare),d=0,g=r.length;d<g;d++)for(var y=r[d].getSweepEvents(),v=0,m=y.length;v<m;v++)if(p.insert(y[v]),p.size>Ze)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var b=new He(p),E=p.size,_=p.pop();_;){var x=_.key;if(p.size===E){var S=x.segment;throw new Error("Unable to pop() ".concat(x.isLeft?"left":"right"," SweepEvent ")+"[".concat(x.point.x,", ").concat(x.point.y,"] from segment #").concat(S.id," ")+"[".concat(S.leftSE.point.x,", ").concat(S.leftSE.point.y,"] -> ")+"[".concat(S.rightSE.point.x,", ").concat(S.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(p.size>Ze)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(b.segments.length>Ke)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var w=b.process(x),P=0,C=w.length;P<C;P++){var M=w[P];void 0===M.consumedBy&&p.insert(M)}E=p.size,_=p.pop()}ke.reset();var I=Je.factory(b.segments);return new We(I).getGeom()}}]),t}()),tn=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Qe.run("difference",t,n)};function en(t,e){var n=m(t),r=m(e),o=t.properties||{},i=tn(n.coordinates,r.coordinates);return 0===i.length?null:1===i.length?l(i[0],o):p(i,o)}const nn="split_polygon",rn="split_polygon_passing_draw_line_string",on="split_polygon_highlight",sn={highlightColor:"#222",lineWidth:0,lineWidthUnit:"kilometers",onSelectFeatureRequest(){throw new Error("no Feature is selected to split.")}};var an=Object.freeze({__proto__:null,modeName:nn,passingModeName:rn,highlightPropertyName:on,defaultOptions:sn});const un={};un.onSetup=function(t){const{featureIds:e=[],highlightColor:n=sn.highlightColor,lineWidth:r=sn.lineWidth,lineWidthUnit:o=sn.lineWidthUnit,onSelectFeatureRequest:i=sn.onSelectFeatureRequest}=t||{},s=this._ctx.api,a=[],u=this.getSelected();if(0!==e.length)a.push.apply(a,e.map((t=>s.get(t))));else{if(0===u.length)return i();a.push.apply(a,u.filter((t=>t.type===it.constants.geojsonTypes.POLYGON||t.type===it.constants.geojsonTypes.MULTI_POLYGON)).map((t=>t.toGeoJSON())))}const l={options:{highlightColor:n,lineWidth:r,lineWidthUnit:o},featuresToSplit:a,api:s};return setTimeout(this.drawAndSplit.bind(this,l),0),this.highlighFeatures(l),l},un.drawAndSplit=function(t){const{api:e,options:n}=t,{lineWidth:r,lineWidthUnit:o}=n;try{this.changeMode(rn,{onDraw:n=>{const i=[];t.featuresToSplit.forEach((t=>{if(Qt(t,n))return console.info(`Line was outside of Polygon ${t.id}`),void i.push(t);if(0===r){const r=(s=t.geometry,a=n.geometry,J(s,a));r.id=t.id,e.add(r),i.push(r)}else{const s=function(t,e,n){const{line_width:r,line_width_unit:o}=n||{},i=[],s=null;let a,u,l,f,h,p,d;if(void 0===r||void 0===o||t.type!=it.constants.geojsonTypes.POLYGON&&t.type!=it.constants.geojsonTypes.MULTI_POLYGON||e.type!=it.constants.geojsonTypes.LINE_STRING)return s;if(Qt(e,t))return s;if(l=Jt(t,e),0===l.features.length)return s;for(i[0]=se(e,r,{units:o}),i[1]=se(e,-r,{units:o}),a=0;a<=1;a++){f=a;const n=[];for(u=0;u<e.coordinates.length;u++)n.push(e.coordinates[u]);for(u=i[f].geometry.coordinates.length-1;u>=0;u--)n.push(i[f].geometry.coordinates[u]);n.push(e.coordinates[0]),h=c(n),p=le(h),d=en(t,p)}return d}(t.geometry,n.geometry,{line_width:r,line_width_unit:o});s.id=t.id,e.add(s),i.push(s)}var s,a})),this.fireUpdate(i),this.highlighFeatures(t,!1)},onCancel:()=>{this.highlighFeatures(t,!1)}})}catch(t){console.error("🚀 ~ file: mode.js ~ line 116 ~ err",t)}},un.highlighFeatures=function(t,e=!0){const n=e?t.options.highlightColor:void 0;t.featuresToSplit.forEach((e=>{t.api.setFeatureProperty(e.id,on,n)}))},un.toDisplayFeatures=function(t,e,n){n(e)},un.fireUpdate=function(t){this.map.fire(it.constants.events.UPDATE,{action:nn,features:t})};const ln="user_split_polygon_highlight",{draw_point:cn}=ot.exports.modes,{onSetup:fn,onClick:hn,...pn}=cn,{draw_line_string:dn}=ot.exports.modes,{doubleClickZoom:gn}=ot.exports.lib,yn=ot.exports.constants,{onSetup:vn,onMouseMove:mn,...bn}=dn,En={originOnSetup:vn,originOnMouseMove:mn,...bn};En.onSetup=function(t){const e=this.originOnSetup(),{onDraw:n,onCancel:r}=t;return e.onDraw=n,e.onCancel=r,e},En.onMouseMove=function(t,e){this.updateUIClasses({mouse:yn.cursors.ADD}),this.originOnMouseMove(t,e)},En.onStop=function(t){const e=t.line;this.updateUIClasses({mouse:yn.cursors.NONE}),gn.enable(this),this.activateUIButton();void 0!==this.getFeature(e.id)?(e.removeCoordinate(`${t.currentVertexPosition}`),e.isValid()&&("function"==typeof t.onDraw?t.onDraw(e.toGeoJSON()):this.map.fire("draw.passing-create",{features:[e.toGeoJSON()]})),this.deleteFeature([e.id],{silent:!0}),this.changeMode(yn.modes.SIMPLE_SELECT,{},{silent:!0})):"function"==typeof t.onCancel&&t.onCancel()};const{draw_polygon:_n}=it.modes;it.lib,it.constants;const{onSetup:xn,onMouseMove:Sn,...wn}=_n,Pn="select_feature",Cn=`${Pn}_highlight`,Mn={highlightColor:"#222"},In=it.constants,On=it.lib,Tn={};function Ln(t){return{...t,[Pn]:Tn}}Tn.onSetup=function(t){const{selectHighlightColor:e,onSelect:n,onCancel:r}=t,o={hoveredFeatureID:null,selectedFeatureID:null};o.onSelect=n,o.onCancel=r,o.api=this._ctx.api;const{selectHighlightColor:i=Mn.highlightColor}=this._ctx.options;return o.options={selectHighlightColor:e||i},o},Tn.onMouseMove=function(t,e){const{api:n}=t,{featureTarget:r}=e;if(r){this.updateUIClasses({mouse:In.cursors.POINTER});const e=r.properties.id;null!==t.hoveredFeatureID&&t.hoveredFeatureID!==e&&n.setFeatureProperty(t.hoveredFeatureID,Cn,void 0),t.hoveredFeatureID=e,n.setFeatureProperty(t.hoveredFeatureID,Cn,t.options.selectHighlightColor)}else t.hoveredFeatureID&&n.setFeatureProperty(t.hoveredFeatureID,Cn,void 0),t.hoveredFeatureID=null},Tn.onClick=function(t,e){t.selectedFeatureID=t.hoveredFeatureID,this.onStop(t,e)},Tn.toDisplayFeatures=function(t,e,n){n(e)},Tn.onKeyUp=function(t,e){CommonSelectors.isEscapeKey(e)&&"function"==typeof t.onCancel&&setTimeout(t.onCancel,0)},Tn.onStop=function(t){this.updateUIClasses({mouse:In.cursors.NONE}),On.doubleClickZoom.enable(this),this.activateUIButton(),t.selectedFeatureID?("function"==typeof t.onSelect?setTimeout(t.onSelect.bind(null,t.selectedFeatureID),0):this.map.fire("draw.select_mode.select",{featureID:t.selectedFeatureID}),t.selectedFeatureID=null):"function"==typeof t.onCancel&&setTimeout(t.onCancel,0),t.hoveredFeatureID&&(this._ctx.api.setFeatureProperty(t.hoveredFeatureID,Cn,void 0),t.hoveredFeatureID=null)},t.Constants=an,t.default=function(t){return{...Ln(t),[rn]:En,[nn]:un}},t.drawStyles=t=>t.map((t=>t.id.endsWith("inactive")?{...t,filter:[...t.filter,["!has",ln]]}:t)).concat([{id:"split_polygon-fill-active",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["has",ln]],paint:{"fill-color":["get",ln],"fill-outline-color":["get",ln],"fill-opacity":.1}},{id:"split_polygon-stroke-active",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["has",ln]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get",ln],"line-dasharray":[.2,2],"line-width":2}}]),t.splitPolygonMode=un,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=index.js.map
